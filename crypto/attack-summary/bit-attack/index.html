<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>比特攻击 - 西山下,闻溪语,书心境</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../../css/theme.css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u6bd4\u7279\u653b\u51fb";
    var mkdocs_page_input_path = "crypto/attack-summary/bit-attack.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> 西山下,闻溪语,书心境</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../..">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Crypto</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../../introduction/">密码学简介</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">基础数学知识</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../basic/introduction/">简介</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">古典密码</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/introduction/">古典密码简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/monoalphabetic/">单表代换加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/polyalphabetic/">多表代换加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/others/">其他类型加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/summary/">总结</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">流密码</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../streamcipher/intro/">介绍</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">伪随机数生成器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/intro/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/csprng/">密码学安全伪随机数生成器</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/problem/">题目</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">线性同余生成器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/lcg/intro/">简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/lcg/challenge/">例题</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">反馈移位寄存器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/intro/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/lfsr/">线性反馈移位寄存器</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/nfsr/">非线性反馈移位寄存器</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">特殊流密码</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/special/rc4/">RC4</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">块加密</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/introduction/">块加密简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/arx-operations/">ARX</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/des/">DES</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/idea/">IDEA</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../blockcipher/aes.md">AES</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/simon-speck/">Simon and Speck</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">分组模式</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/introduction/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/padding/">填充方式</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/ecb/">ECB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/cbc/">CBC</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/pcbc/">PCBC</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/cfb/">CFB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/ofb/">OFB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/ctr/">CTR</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/padding-oracle-attack/">Padding Oracle Attack</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">非对称加密</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../asymmetric/introduction/">非对称加密简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">RSA</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_theory/">RSA 基本介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_module_attack/">模数相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_e_attack/">公钥指数相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_d_attack/">私钥 d 相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../asymmetric/rsa/rsa_coppersmith_attack.md">Coppersmith 相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_chosen_plain_cipher/">选择明密文攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_side_channel/">侧信道攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_pkcs_attack/">Bleichenbacher 攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_complex/">综合</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../asymmetric/knapsack/knapsack/">背包加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">离散对数相关</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/discrete-log/">离散对数</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/elgamal/">Elgamal</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/ecc/">ECC</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">格密码</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/overview/">格概述</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/introduction/">格介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/lattice-reduction/">格基规约算法</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/cvp/">CVP</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">哈希函数</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/introduction/">哈希函数简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/md5/">MD5</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/sha1/">SHA1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/fnv/">FNV</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/attack/">Hash Attack</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/complex/">综合</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">数字签名</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/introduction/">数字签名简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/rsa/">RSA 数字签名</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../signature/elgamal.md">ElGamal 数字签名</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/dsa/">DSA 数字签名</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">攻击思想总结</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../attack-mode/">简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../meet-in-the-middle/">中间相遇攻击</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="./">比特攻击</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#2018-plaid-ctf-transducipher">2018 Plaid CTF transducipher</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#reference">Reference</a>
    </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">西山下,闻溪语,书心境</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>攻击思想总结 &raquo;</li>
        
      
        
          <li>非对称加密 &raquo;</li>
        
      
        
          <li>Crypto &raquo;</li>
        
      
    
    <li>比特攻击</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><a href="./">EN</a> | <a href="../bit-attack-zh/">ZH</a></p>
<h1 id="_1">比特攻<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Simply put, it is to use the relationship between the bits to attack.</p>
<h2 id="2018-plaid-ctf-transducipher">2018 Plaid CTF transducipher<a class="headerlink" href="#2018-plaid-ctf-transducipher" title="Permanent link">&para;</a></h2>
<p>The title is as follows</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3.6</span>

<span class="kn">import</span>


<span class="nn">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">64</span>



<span class="n">T</span> <span class="o">=</span> <span class="p">[</span>

    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>

<span class="p">]</span>





<span class="k">def</span> <span class="nf">block2bin</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">BLOCK_SIZE</span><span class="p">):</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bin</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)))</span>





<span class="k">def</span> <span class="nf">bin2block</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>

    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">b</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">transduce</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

<span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">b</span>

    <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

    <span class="n">b0</span><span class="p">,</span> <span class="n">bp</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">b0</span> <span class="o">^</span> <span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">transduce</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">b0</span><span class="p">])</span>





<span class="k">def</span> <span class="nf">transduceblock</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">bin2block</span><span class="p">(</span><span class="n">transduce</span><span class="p">(</span><span class="n">block2bin</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>





<span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">BLOCK_SIZE</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="n">l</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">l</span><span class="p">)</span>





<span class="k">class</span> <span class="nc">Transducipher</span><span class="p">:</span>



    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>

<span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>

            <span class="n">k</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">transduceblock</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>

            <span class="n">b</span> <span class="o">^=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">transduceblock</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">b</span>





<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">flag</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">hex</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">//</span> <span class="mi">8</span><span class="p">))</span>

    <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">Transducipher</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your flag is PCTF{</span><span class="si">%s</span><span class="s2">}&quot;</span> <span class="o">%</span> <span class="n">flag</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>

            <span class="n">pt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">hex</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)),</span> <span class="mi">16</span><span class="p">)</span>

            <span class="n">ct</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">pt</span><span class="p">,</span> <span class="n">ct</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p>The topic gave 16 groups of ciphertext pairs.</p>
<ul>
<li>Clear text size 8 bytes</li>
<li>cipher text size 8 bytes</li>
<li>The key size is also 8 bytes</li>
</ul>
<p>The key we need to solve is the key.</p>
<p>It can be seen that there are two main operations here.</p>
<ul>
<li>swap</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>

    <span class="n">l</span> <span class="o">=</span> <span class="n">BLOCK_SIZE</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="n">l</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">b</span> <span class="o">&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">l</span><span class="p">)</span>
</code></pre></div>

<p>Swaps the upper 32 bits of the given data with the lower 32 bits.</p>
<ul>
<li>transduce</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">T</span> <span class="o">=</span> <span class="p">[</span>

    <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>

    <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>

<span class="p">]</span>

<span class="k">def</span> <span class="nf">transduce</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

<span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">b</span>

    <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

    <span class="n">b0</span><span class="p">,</span> <span class="n">bp</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">b0</span> <span class="o">^</span> <span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">transduce</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">b0</span><span class="p">])</span>
</code></pre></div>

<p>among them,</p>
<ul>
<li>b is an array of 01 with an initial time size of 64.</li>
<li>s is a subscript.</li>
</ul>
<p>The basic process is as follows</p>
<ol>
<li>Select which element of T to use based on s and divide it into d and t.</li>
<li>Divide b into two parts, one containing only the head element and the other containing the other elements.</li>
<li>XOR the header element with t as the current header element and continue to convert the rest.</li>
</ol>
<p>In fact, we can convert this function into an iterative function.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">transduce_iter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

<span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>

        <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

<span class="n">years</span> <span class="o">+</span> <span class="o">=</span> <span class="p">[</span><span class="n">ct</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>

<span class="k">return</span> <span class="n">years</span>
</code></pre></div>

<p>And since each time the first element of the list is processed, the function is actually reversible, as follows</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">invtransduce</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

<span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">b</span>

    <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

    <span class="n">b0</span><span class="p">,</span> <span class="n">bp</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">b0</span> <span class="o">^</span> <span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">transduce</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">b0</span> <span class="o">^</span> <span class="n">t</span><span class="p">])</span>
</code></pre></div>

<p>The following is the core flow of the analysis program. The first is to generate the key part. The encryption algorithm generates 6 keys, each time the method is generated.</p>
<ol>
<li>transduce the previous key to get the intermediate value t</li>
<li>Swap t</li>
<li>Continuous iteration 5 times</li>
</ol>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>

<span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>

            <span class="n">k</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">transduceblock</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</code></pre></div>

<p>The encryption algorithm is as follows, a total of 6 iterations, the basic process</p>
<p>XOR key transduce
2. Exchange</p>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>

            <span class="n">b</span> <span class="o">^=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">transduceblock</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">swap</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">b</span>
</code></pre></div>

<p>Through the analysis program, it can be known that the encryption algorithm is a block encryption, and the basic information is as follows</p>
<ul>
<li>Block size is 8 bytes</li>
<li>Rounds of 6 rounds</li>
<li>The basic operations of each round of the encryption algorithm are transduce and swap.</li>
<li>The extension of the key is also related to transduce and swap.</li>
</ul>
<p>more specific</p>
<ol>
<li>swap is to swap the upper 32 bits of the 8 bytes with the lower 32 bits.</li>
<li>transduce is XORed to a value bit by bit for each bit of 8 bytes. This value is related to T.</li>
</ol>
<p>Through further analysis, we can find that these two functions are all reversible. That is to say, if we know the final ciphertext, then we can actually shorten the original number of rounds to almost 5 rounds, because the last round of <code>transduce</code> and <code>swap</code> have no effect.</p>
<p>We can define the following variables</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>| <span><span class="MathJax_Preview">k_{i,0}</span><script type="math/tex">k_{i,0}</script></span> | The upper 32 bits of the key used in the i-th round |
| <span><span class="MathJax_Preview">k_{i,1}</span><script type="math/tex">k_{i,1}</script></span> | The lower 32 bits of the key used in the i-th round |
| <span><span class="MathJax_Preview">d_{i,0}</span><script type="math/tex">d_{i,0}</script></span> | The upper 32 bits of the input used by the i-th wheel |
| <span><span class="MathJax_Preview">d_{i,1}</span><script type="math/tex">d_{i,1}</script></span> | The lower 32 bits of the input used by the i-th wheel |</p>
<p>Since one of the core operations is swap, only high or low 32 bits are manipulated, so we can consider it in two parts. The simplified definition is as follows</p>
<ul>
<li>Transduce is simplified to T, although it conflicts with the source code, but we can temporarily understand it.</li>
<li>Swap is reduced to S.</li>
</ul>
<p>Then each round of the ciphertext, the key is as follows</p>
<table>
<thead>
<tr>
<th>Number of rounds</th>
<th>Left key</th>
<th>Left ciphertext</th>
<th>Right key</th>
<th>Right ciphertext</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>| 0    | <span><span class="MathJax_Preview">k_{0,0}</span><script type="math/tex">k_{0,0}</script></span>              | <span><span class="MathJax_Preview">d_{1,0}=T(k_{0,1} \oplus d_{0,1} ,s)</span><script type="math/tex">d_{1,0}=T(k_{0,1} \oplus d_{0,1} ,s)</script></span> | <span><span class="MathJax_Preview">k_{0,1}</span><script type="math/tex">k_{0,1}</script></span>            | <span><span class="MathJax_Preview">d_{1,1}=T(k_{0,0} \oplus d_{0,0})</span><script type="math/tex">d_{1,1}=T(k_{0,0} \oplus d_{0,0})</script></span> |</p>
<p>| 1    | <span><span class="MathJax_Preview">k_{1,0}=T(k_{0,1},s)</span><script type="math/tex">k_{1,0}=T(k_{0,1},s)</script></span> | <span><span class="MathJax_Preview">d_{2,0}=T(k_{1,1} \oplus d_{1,1} ,s)</span><script type="math/tex">d_{2,0}=T(k_{1,1} \oplus d_{1,1} ,s)</script></span> | <span><span class="MathJax_Preview">k_{1,1}=T(k_{0,0})</span><script type="math/tex">k_{1,1}=T(k_{0,0})</script></span> | <span><span class="MathJax_Preview">d_{2,1}=T(k_{1,0} \oplus d_{1,0})</span><script type="math/tex">d_{2,1}=T(k_{1,0} \oplus d_{1,0})</script></span> |</p>
<p>| 2    | <span><span class="MathJax_Preview">k_{2,0}=T(k_{1,1},s)</span><script type="math/tex">k_{2,0}=T(k_{1,1},s)</script></span> | <span><span class="MathJax_Preview">d_{3,0}=T(k_{2,1} \oplus d_{2,1} ,s)</span><script type="math/tex">d_{3,0}=T(k_{2,1} \oplus d_{2,1} ,s)</script></span> | <span><span class="MathJax_Preview">k_{2,1}=T(k_{1,0})</span><script type="math/tex">k_{2,1}=T(k_{1,0})</script></span> | <span><span class="MathJax_Preview">d_{3,1}=T(k_{2,0} \oplus d_{2,0})</span><script type="math/tex">d_{3,1}=T(k_{2,0} \oplus d_{2,0})</script></span> |</p>
<p>| 3    | <span><span class="MathJax_Preview">k_{3,0}=T(k_{2,1},s)</span><script type="math/tex">k_{3,0}=T(k_{2,1},s)</script></span> | <span><span class="MathJax_Preview">d_{4,0}=T(k_{3,1} \oplus d_{3,1} ,s)</span><script type="math/tex">d_{4,0}=T(k_{3,1} \oplus d_{3,1} ,s)</script></span> | <span><span class="MathJax_Preview">k_{3,1}=T(k_{2,0})</span><script type="math/tex">k_{3,1}=T(k_{2,0})</script></span> | <span><span class="MathJax_Preview">d_{4,1}=T(k_{3,0} \oplus d_{3,0})</span><script type="math/tex">d_{4,1}=T(k_{3,0} \oplus d_{3,0})</script></span> |</p>
<p>| 4    | <span><span class="MathJax_Preview">k_{4,0}=T(k_{3,1},s)</span><script type="math/tex">k_{4,0}=T(k_{3,1},s)</script></span> | <span><span class="MathJax_Preview">d_{5,0}=T(k_{4,1} \oplus d_{4,1} ,s)</span><script type="math/tex">d_{5,0}=T(k_{4,1} \oplus d_{4,1} ,s)</script></span> | <span><span class="MathJax_Preview">k_{4,1}=T(k_{3,0})</span><script type="math/tex">k_{4,1}=T(k_{3,0})</script></span> | <span><span class="MathJax_Preview">d_{5,1}=T(k_{4,0} \oplus d_{4,0})</span><script type="math/tex">d_{5,1}=T(k_{4,0} \oplus d_{4,0})</script></span> |</p>
<p>| 5    | <span><span class="MathJax_Preview">k_{5,0}=T(k_{4,1},s)</span><script type="math/tex">k_{5,0}=T(k_{4,1},s)</script></span> | <span><span class="MathJax_Preview">d_{6,0}=T(k_{5,1} \oplus d_{5,1} ,s)</span><script type="math/tex">d_{6,0}=T(k_{5,1} \oplus d_{5,1} ,s)</script></span> | <span><span class="MathJax_Preview">k_{5,1}=T(k_{4,0})</span><script type="math/tex">k_{5,1}=T(k_{4,0})</script></span> | <span><span class="MathJax_Preview">d_{6,1}=T(k_{5,0} \oplus d_{5,0})</span><script type="math/tex">d_{6,1}=T(k_{5,0} \oplus d_{5,0})</script></span> |</p>
<p>Then, we can enumerate the upper 32 bits of k bit by bit and enumerate the possible s status bits when performing the T operation, so that we can get the high 32-bit key. After performing a bit-by-bit blast, we can get two possible results</p>
<div class="highlight"><pre><span></span><code>[2659900894, 2659900895]
</code></pre></div>

<p>According to the results on the left, you can get the possible results on the right. The possible results obtained with 2659900894 are as follows:</p>
<div class="highlight"><pre><span></span><code># The first set of ciphertexts may have too many corresponding keys.
# The second group has a total of 6.
[2764038144, 2764038145, 2764038152, 2764038153, 2764038154, 2764038155]

# The third group
[2764038144, 2764038145]
</code></pre></div>

<p>Then in fact, we can manually try to encrypt all the ciphertext, if not, just judge the error directly. This can actually be filtered very quickly. Finally, you can find that the key is</p>
<div class="highlight"><pre><span></span><code>2659900894|2764038145
</code></pre></div>

<p>That is 11624187353095200769. Also got the flag.</p>
<p>Of course, this problem can also use the attack method of the middle encounter, that is, the key used in the 0<sup>th</sup> round and the key used in the last round are respectively enumerated to make a collision in the third round.</p>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="http://blog.rb-tree.xyz/2018/05/07/plaidctf-2018-transducipher/">http://blog.rb-tree.xyz/2018/05/07/plaidctf-2018-transducipher/</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../about/" class="btn btn-neutral float-right" title="About">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../meet-in-the-middle/" class="btn btn-neutral" title="中间相遇攻击"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../meet-in-the-middle/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../../about/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
      <script src="../../../_static/js/extra.js" defer></script>
      <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
