<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../img/favicon.ico">
        <title>CBC - 西山下,闻溪语,书心境</title>
        <link href="../../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../../..">西山下,闻溪语,书心境</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Index <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../.." class="dropdown-item">首页</a>
</li>
                                    
<li>
    <a href="../../../../../about/" class="dropdown-item">关于我</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Crypto <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">ctf-wiki中的资料</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../introduction/" class="dropdown-item">密码学简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">基础数学知识</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../basic/introduction/" class="dropdown-item">简介</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">古典密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../classical/introduction/" class="dropdown-item">古典密码简介</a>
</li>
            
<li>
    <a href="../../../classical/monoalphabetic/" class="dropdown-item">单表代换加密</a>
</li>
            
<li>
    <a href="../../../classical/polyalphabetic/" class="dropdown-item">多表代换加密</a>
</li>
            
<li>
    <a href="../../../classical/others/" class="dropdown-item">其他类型加密</a>
</li>
            
<li>
    <a href="../../../classical/summary/" class="dropdown-item">总结</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/intro/" class="dropdown-item">介绍</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">伪随机数生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/prng/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../streamcipher/prng/csprng/" class="dropdown-item">密码学安全伪随机数生成器</a>
</li>
            
<li>
    <a href="../../../streamcipher/prng/problem/" class="dropdown-item">题目</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">线性同余生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/lcg/intro/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../../streamcipher/lcg/challenge/" class="dropdown-item">例题</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">反馈移位寄存器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/fsr/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../streamcipher/fsr/lfsr/" class="dropdown-item">线性反馈移位寄存器</a>
</li>
            
<li>
    <a href="../../../streamcipher/fsr/nfsr/" class="dropdown-item">非线性反馈移位寄存器</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">特殊流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/special/rc4/" class="dropdown-item">RC4</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">块加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../introduction/" class="dropdown-item">块加密简介</a>
</li>
            
<li>
    <a href="../../arx-operations/" class="dropdown-item">ARX</a>
</li>
            
<li>
    <a href="../../des/" class="dropdown-item">DES</a>
</li>
            
<li>
    <a href="../../idea/" class="dropdown-item">IDEA</a>
</li>
            
<li>
    <a href="../../aes.md" class="dropdown-item">AES</a>
</li>
            
<li>
    <a href="../../simon-speck/" class="dropdown-item">Simon and Speck</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">分组模式</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../introduction/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../padding/" class="dropdown-item">填充方式</a>
</li>
            
<li>
    <a href="../ecb/" class="dropdown-item">ECB</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">CBC</a>
</li>
            
<li>
    <a href="../pcbc/" class="dropdown-item">PCBC</a>
</li>
            
<li>
    <a href="../cfb/" class="dropdown-item">CFB</a>
</li>
            
<li>
    <a href="../ofb/" class="dropdown-item">OFB</a>
</li>
            
<li>
    <a href="../ctr/" class="dropdown-item">CTR</a>
</li>
            
<li>
    <a href="../padding-oracle-attack/" class="dropdown-item">Padding Oracle Attack</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">非对称加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../asymmetric/introduction/" class="dropdown-item">非对称加密简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">RSA</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../asymmetric/rsa/rsa_theory/" class="dropdown-item">RSA 基本介绍</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_module_attack/" class="dropdown-item">模数相关攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_e_attack/" class="dropdown-item">公钥指数相关攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_d_attack/" class="dropdown-item">私钥 d 相关攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_coppersmith_attack.md" class="dropdown-item">Coppersmith 相关攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_chosen_plain_cipher/" class="dropdown-item">选择明密文攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_side_channel/" class="dropdown-item">侧信道攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_pkcs_attack/" class="dropdown-item">Bleichenbacher 攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../asymmetric/knapsack/knapsack/" class="dropdown-item">背包加密</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">离散对数相关</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../asymmetric/discrete-log/discrete-log/" class="dropdown-item">离散对数</a>
</li>
            
<li>
    <a href="../../../asymmetric/discrete-log/elgamal/" class="dropdown-item">Elgamal</a>
</li>
            
<li>
    <a href="../../../asymmetric/discrete-log/ecc/" class="dropdown-item">ECC</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">格密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../asymmetric/lattice/overview/" class="dropdown-item">格概述</a>
</li>
            
<li>
    <a href="../../../asymmetric/lattice/introduction/" class="dropdown-item">格介绍</a>
</li>
            
<li>
    <a href="../../../asymmetric/lattice/lattice-reduction/" class="dropdown-item">格基规约算法</a>
</li>
            
<li>
    <a href="../../../asymmetric/lattice/cvp/" class="dropdown-item">CVP</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">哈希函数</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../hash/introduction/" class="dropdown-item">哈希函数简介</a>
</li>
            
<li>
    <a href="../../../hash/md5/" class="dropdown-item">MD5</a>
</li>
            
<li>
    <a href="../../../hash/sha1/" class="dropdown-item">SHA1</a>
</li>
            
<li>
    <a href="../../../hash/fnv/" class="dropdown-item">FNV</a>
</li>
            
<li>
    <a href="../../../hash/attack/" class="dropdown-item">Hash Attack</a>
</li>
            
<li>
    <a href="../../../hash/complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">数字签名</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../signature/introduction/" class="dropdown-item">数字签名简介</a>
</li>
            
<li>
    <a href="../../../signature/rsa/" class="dropdown-item">RSA 数字签名</a>
</li>
            
<li>
    <a href="../../../signature/elgamal.md" class="dropdown-item">ElGamal 数字签名</a>
</li>
            
<li>
    <a href="../../../signature/dsa/" class="dropdown-item">DSA 数字签名</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">攻击思想总结</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../attack-summary/attack-mode/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../../attack-summary/meet-in-the-middle/" class="dropdown-item">中间相遇攻击</a>
</li>
            
<li>
    <a href="../../../attack-summary/bit-attack/" class="dropdown-item">比特攻击</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../ecb/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../pcbc/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#cbc" class="nav-link">CBC</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#encryption" class="nav-link">Encryption</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#decryption" class="nav-link">decryption</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#advantages-and-disadvantages" class="nav-link">Advantages and disadvantages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#application" class="nav-link">Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#attack" class="nav-link">Attack</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="./">EN</a> | <a href="../cbc-zh/">ZH</a></p>
<h1 id="cbc">CBC<a class="headerlink" href="#cbc" title="Permanent link">&para;</a></h1>
<p>CBC is called the Cipher-block chaining mode, here</p>
<ul>
<li>IV does not require confidentiality</li>
<li>IV must be unpredictable and must be complete.</li>
</ul>
<h2 id="encryption">Encryption<a class="headerlink" href="#encryption" title="Permanent link">&para;</a></h2>
<p><img alt="" src="../figure/cbc_encryption.png" /></p>
<h2 id="decryption">decryption<a class="headerlink" href="#decryption" title="Permanent link">&para;</a></h2>
<p><img alt="" src="../figure/cbc_decryption.png" /></p>
<h2 id="advantages-and-disadvantages">Advantages and disadvantages<a class="headerlink" href="#advantages-and-disadvantages" title="Permanent link">&para;</a></h2>
<h3 id="advantages">Advantages<a class="headerlink" href="#advantages" title="Permanent link">&para;</a></h3>
<ol>
<li>The ciphertext block is not only related to the current ciphertext block, but also related to the previous ciphertext block or IV, hiding the statistical properties of the plaintext.</li>
<li>Has a limited two-step error propagation feature, that is, a one-bit change in the ciphertext block only affects the current ciphertext block and the next ciphertext block.</li>
<li>With self-synchronization feature, that is, the k-th block is correct, the k+1th block can be decrypted normally.</li>
</ol>
<h3 id="disadvantages">Disadvantages<a class="headerlink" href="#disadvantages" title="Permanent link">&para;</a></h3>
<ol>
<li>Encryption cannot be parallel, decryption can be parallel.</li>
</ol>
<h2 id="application">Application<a class="headerlink" href="#application" title="Permanent link">&para;</a></h2>
<p>CBC is widely used</p>
<ul>
<li>Common data encryption and TLS encryption.</li>
<li>Integrity and identity authentication.</li>
</ul>
<h2 id="attack">Attack<a class="headerlink" href="#attack" title="Permanent link">&para;</a></h2>
<h3 id="byte-reversal-attack">Byte reversal attack<a class="headerlink" href="#byte-reversal-attack" title="Permanent link">&para;</a></h3>
<h4 id="principle">Principle<a class="headerlink" href="#principle" title="Permanent link">&para;</a></h4>
<p>The principle of byte inversion is very simple, we observe the <strong> decryption process </strong> can find the following characteristics:</p>
<ul>
<li>IV vector affects the first plaintext grouping</li>
<li>The nth ciphertext packet can affect the n + 1 plaintext packet</li>
</ul>
<p>Assuming that the <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> ciphertext is grouped as <span><span class="MathJax_Preview">C_n</span><script type="math/tex">C_n</script></span>, the decrypted <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> plaintext is grouped as <span><span class="MathJax_Preview">P_n</span><script type="math/tex">P_n</script></span>.</p>
<p>Then <span><span class="MathJax_Preview">P_{n+1}=C_n~\text{xor}~f(C_{n+1})</span><script type="math/tex">P_{n+1}=C_n~\text{xor}~f(C_{n+1})</script></span>.</p>
<p>The <span><span class="MathJax_Preview">f</span><script type="math/tex">f</script></span> function is <span><span class="MathJax_Preview">\text{Block Cipher Decryption}</span><script type="math/tex">\text{Block Cipher Decryption}</script></span> in the figure.</p>
<p>For the original text and ciphertext of a certain information, then we can modify the <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> ciphertext block <span><span class="MathJax_Preview">C_n</span><script type="math/tex">C_n</script></span> to <span><span class="MathJax_Preview">C_n~\text{xor}~P_{n+1}~\text{xor}~ A</span><script type="math/tex">C_n~\text{xor}~P_{n+1}~\text{xor}~ A</script></span>. Then decrypt the ciphertext, then the decrypted <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> plaintext will soon become <span><span class="MathJax_Preview">A</span><script type="math/tex">A</script></span>.</p>
<h4 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flag</span> <span class="kn">import</span> <span class="n">FLAG</span>

<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>

<span class="kn">from</span> <span class="nn">Crypto</span> <span class="kn">import</span> <span class="n">Random</span>

<span class="kn">import</span> <span class="nn">base64</span>



<span class="n">BLOCK_SIZE</span><span class="o">=</span><span class="mi">16</span>

<span class="n">IV</span> <span class="o">=</span> <span class="n">Random</span><span class="o">.</span><span class="n">new</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">BLOCK_SIZE</span><span class="p">)</span>

<span class="n">passphrase</span> <span class="o">=</span> <span class="n">Random</span><span class="o">.</span><span class="n">new</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">BLOCK_SIZE</span><span class="p">)</span>



<span class="n">pad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">*</span> <span class="nb">chr</span><span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span>

<span class="n">unpad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="p">[:</span> <span class="o">-</span> <span class="nb">ord</span> <span class="p">(</span><span class="n">s</span> <span class="p">[</span><span class="nb">len</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:])]</span>


<span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;flag=&quot;</span><span class="o">+</span><span class="n">FLAG</span><span class="o">+</span><span class="s2">&quot;&amp;userdata=&quot;</span>

<span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&amp;user=guest&quot;</span>

<span class="k">def</span> <span class="nf">menu</span><span class="p">():</span>

    <span class="nb">print</span> <span class="s2">&quot;1. encrypt&quot;</span>

    <span class="nb">print</span> <span class="s2">&quot;2. decrypt&quot;</span>

    <span class="k">return</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;&gt; &quot;</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">encrypt</span><span class="p">():</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;your data: &quot;</span><span class="p">)</span>

    <span class="n">plain</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">+</span><span class="n">data</span><span class="o">+</span><span class="n">suffix</span>

    <span class="n">aes</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">passphrase</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">IV</span><span class="p">)</span>

    <span class="nb">print</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">aes</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">plain</span><span class="p">)))</span>





<span class="k">def</span> <span class="nf">decrypt</span><span class="p">():</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;input data: &quot;</span><span class="p">)</span>

    <span class="n">aes</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">passphrase</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">IV</span><span class="p">)</span>

<span class="n">plain</span> <span class="o">=</span> <span class="n">unpad</span> <span class="p">(</span><span class="n">aes</span><span class="o">.</span><span class="n">decrypt</span> <span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span> <span class="p">(</span><span class="n">data</span><span class="p">)))</span>
    <span class="nb">print</span> <span class="s1">&#39;DEBUG ====&gt; &#39;</span> <span class="o">+</span> <span class="n">plain</span>

    <span class="k">if</span> <span class="n">plain</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">==</span><span class="s2">&quot;admin&quot;</span><span class="p">:</span>

        <span class="nb">print</span> <span class="n">plain</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="nb">print</span> <span class="s2">&quot;you are not admin&quot;</span>



<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="n">menu</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cmd</span><span class="o">==</span><span class="s2">&quot;1&quot;</span><span class="p">:</span>

            <span class="n">encrypt</span><span class="p">()</span>

<span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="mi">2</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;:</span>
            <span class="n">decrypt</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">exit</span><span class="p">()</span>



<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>Visible topic I hope we provide an encrypted string, if the final content of this string is admin. The program will output clear text. Therefore, the problem flow is to provide a plain text first, and then modify the ciphertext so that the final content of the decrypted string is admin. We can enumerate the length of the flag to determine where we need to modify it.</p>
<p>The following is exp.py</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">base64</span>



<span class="n">pad</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="n">pad</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;xxx.xxx.xxx.xxx&#39;</span><span class="p">,</span> <span class="mi">10004</span><span class="p">)</span>

    <span class="c1">#r = process(&#39;./chall.sh&#39;)</span>



    <span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>

    <span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;your data: &#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">cipher</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">()))</span>

    <span class="c1">#print &#39;cipher ===&gt;&#39;, &#39;&#39;.join(cipher)</span>



    <span class="n">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;flag=&quot;</span> <span class="o">+</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;&amp;userdata=&quot;</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&amp;user=guest&quot;</span>

    <span class="n">plain</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="n">suffix</span>



    <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">22</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span> <span class="o">+</span> <span class="p">((</span><span class="mi">22</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span> <span class="o">/</span> <span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">BLOCK_SIZE</span>

    <span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">0</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span>

    <span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">))</span>

    <span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">))</span>

    <span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">))</span>

    <span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">cipher</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">4</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span>



    <span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>

    <span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;input data: &#39;</span><span class="p">,</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cipher</span><span class="p">)))</span>



    <span class="n">msg</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;you are not admin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>

        <span class="nb">print</span> <span class="n">msg</span>

        <span class="k">break</span>

    <span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
</code></pre></div>

<h3 id="padding-oracle-attack">Padding Oracle Attack<a class="headerlink" href="#padding-oracle-attack" title="Permanent link">&para;</a></h3>
<p>See the introduction below for details.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../../js/base.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
        <script src="../../../../../_static/js/extra.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
