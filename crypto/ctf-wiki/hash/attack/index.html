<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>Hash Attack - 西山下,闻溪语,书心境</title>
        <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../..">西山下,闻溪语,书心境</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Index <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../.." class="dropdown-item">首页</a>
</li>
                                    
<li>
    <a href="../../../../about/" class="dropdown-item">关于我</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Crypto <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">ctf-wiki中的资料</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../introduction/" class="dropdown-item">密码学简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">基础数学知识</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../basic/introduction/" class="dropdown-item">简介</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">古典密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../classical/introduction/" class="dropdown-item">古典密码简介</a>
</li>
            
<li>
    <a href="../../classical/monoalphabetic/" class="dropdown-item">单表代换加密</a>
</li>
            
<li>
    <a href="../../classical/polyalphabetic/" class="dropdown-item">多表代换加密</a>
</li>
            
<li>
    <a href="../../classical/others/" class="dropdown-item">其他类型加密</a>
</li>
            
<li>
    <a href="../../classical/summary/" class="dropdown-item">总结</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../streamcipher/intro/" class="dropdown-item">介绍</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">伪随机数生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../streamcipher/prng/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../streamcipher/prng/csprng/" class="dropdown-item">密码学安全伪随机数生成器</a>
</li>
            
<li>
    <a href="../../streamcipher/prng/problem/" class="dropdown-item">题目</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">线性同余生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../streamcipher/lcg/intro/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../streamcipher/lcg/challenge/" class="dropdown-item">例题</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">反馈移位寄存器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../streamcipher/fsr/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../streamcipher/fsr/lfsr/" class="dropdown-item">线性反馈移位寄存器</a>
</li>
            
<li>
    <a href="../../streamcipher/fsr/nfsr/" class="dropdown-item">非线性反馈移位寄存器</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">特殊流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../streamcipher/special/rc4/" class="dropdown-item">RC4</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">块加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../blockcipher/introduction/" class="dropdown-item">块加密简介</a>
</li>
            
<li>
    <a href="../../blockcipher/arx-operations/" class="dropdown-item">ARX</a>
</li>
            
<li>
    <a href="../../blockcipher/des/" class="dropdown-item">DES</a>
</li>
            
<li>
    <a href="../../blockcipher/idea/" class="dropdown-item">IDEA</a>
</li>
            
<li>
    <a href="../../blockcipher/aes.md" class="dropdown-item">AES</a>
</li>
            
<li>
    <a href="../../blockcipher/simon-speck/" class="dropdown-item">Simon and Speck</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">分组模式</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../blockcipher/mode/introduction/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../blockcipher/mode/padding/" class="dropdown-item">填充方式</a>
</li>
            
<li>
    <a href="../../blockcipher/mode/ecb/" class="dropdown-item">ECB</a>
</li>
            
<li>
    <a href="../../blockcipher/mode/cbc/" class="dropdown-item">CBC</a>
</li>
            
<li>
    <a href="../../blockcipher/mode/pcbc/" class="dropdown-item">PCBC</a>
</li>
            
<li>
    <a href="../../blockcipher/mode/cfb/" class="dropdown-item">CFB</a>
</li>
            
<li>
    <a href="../../blockcipher/mode/ofb/" class="dropdown-item">OFB</a>
</li>
            
<li>
    <a href="../../blockcipher/mode/ctr/" class="dropdown-item">CTR</a>
</li>
            
<li>
    <a href="../../blockcipher/mode/padding-oracle-attack/" class="dropdown-item">Padding Oracle Attack</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">非对称加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../asymmetric/introduction/" class="dropdown-item">非对称加密简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">RSA</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../asymmetric/rsa/rsa_theory/" class="dropdown-item">RSA 基本介绍</a>
</li>
            
<li>
    <a href="../../asymmetric/rsa/rsa_module_attack/" class="dropdown-item">模数相关攻击</a>
</li>
            
<li>
    <a href="../../asymmetric/rsa/rsa_e_attack/" class="dropdown-item">公钥指数相关攻击</a>
</li>
            
<li>
    <a href="../../asymmetric/rsa/rsa_d_attack/" class="dropdown-item">私钥 d 相关攻击</a>
</li>
            
<li>
    <a href="../../asymmetric/rsa/rsa_coppersmith_attack.md" class="dropdown-item">Coppersmith 相关攻击</a>
</li>
            
<li>
    <a href="../../asymmetric/rsa/rsa_chosen_plain_cipher/" class="dropdown-item">选择明密文攻击</a>
</li>
            
<li>
    <a href="../../asymmetric/rsa/rsa_side_channel/" class="dropdown-item">侧信道攻击</a>
</li>
            
<li>
    <a href="../../asymmetric/rsa/rsa_pkcs_attack/" class="dropdown-item">Bleichenbacher 攻击</a>
</li>
            
<li>
    <a href="../../asymmetric/rsa/rsa_complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../asymmetric/knapsack/knapsack/" class="dropdown-item">背包加密</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">离散对数相关</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../asymmetric/discrete-log/discrete-log/" class="dropdown-item">离散对数</a>
</li>
            
<li>
    <a href="../../asymmetric/discrete-log/elgamal/" class="dropdown-item">Elgamal</a>
</li>
            
<li>
    <a href="../../asymmetric/discrete-log/ecc/" class="dropdown-item">ECC</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">格密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../asymmetric/lattice/overview/" class="dropdown-item">格概述</a>
</li>
            
<li>
    <a href="../../asymmetric/lattice/introduction/" class="dropdown-item">格介绍</a>
</li>
            
<li>
    <a href="../../asymmetric/lattice/lattice-reduction/" class="dropdown-item">格基规约算法</a>
</li>
            
<li>
    <a href="../../asymmetric/lattice/cvp/" class="dropdown-item">CVP</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">哈希函数</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../introduction/" class="dropdown-item">哈希函数简介</a>
</li>
            
<li>
    <a href="../md5/" class="dropdown-item">MD5</a>
</li>
            
<li>
    <a href="../sha1/" class="dropdown-item">SHA1</a>
</li>
            
<li>
    <a href="../fnv/" class="dropdown-item">FNV</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Hash Attack</a>
</li>
            
<li>
    <a href="../complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">数字签名</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../signature/introduction/" class="dropdown-item">数字签名简介</a>
</li>
            
<li>
    <a href="../../signature/rsa/" class="dropdown-item">RSA 数字签名</a>
</li>
            
<li>
    <a href="../../signature/elgamal.md" class="dropdown-item">ElGamal 数字签名</a>
</li>
            
<li>
    <a href="../../signature/dsa/" class="dropdown-item">DSA 数字签名</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">攻击思想总结</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../attack-summary/attack-mode/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../attack-summary/meet-in-the-middle/" class="dropdown-item">中间相遇攻击</a>
</li>
            
<li>
    <a href="../../attack-summary/bit-attack/" class="dropdown-item">比特攻击</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../fnv/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../complex/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#hash-attack" class="nav-link">Hash Attack</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#violent-attack" class="nav-link">violent attack</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#hash-length-extension-attacks" class="nav-link">hash length extension attacks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#hash-algorithm-is-incorrectly-designed" class="nav-link">hash algorithm is incorrectly designed</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="./">EN</a> | <a href="../attack-zh/">ZH</a></p>
<h1 id="hash-attack">Hash Attack<a class="headerlink" href="#hash-attack" title="Permanent link">&para;</a></h1>
<p>Common hash function attack methods are mainly</p>
<ul>
<li>Violent attack: does not depend on any algorithm details, only related to the length of the hash value;</li>
<li>Birthday Attack: The structure and any algebraic weak nature of the hash function are not used, depending only on the length of the message digest, which is the length of the hash value.</li>
<li>Meet-In-The-Middle: It is a variant of a birthday attack. Instead of comparing hash values, it compares intermediate variables. This type of attack is mainly used to attack Hash schemes with a packet chain structure.</li>
<li>Password analysis: Depends on the design shortcomings of specific algorithms.</li>
</ul>
<h2 id="violent-attack">violent attack<a class="headerlink" href="#violent-attack" title="Permanent link">&para;</a></h2>
<p><strong>HashCat tool</strong> can be said to be the best CPU and GPU-based cracking Hash software, the related links are as follows</p>
<p>[HashCat official website] (<a href="http://www.hashcat.net/hashcat/">http://www.hashcat.net/hashcat/</a>)</p>
<p>[HashCat Simple to use] (<a href="http://www.freebuf.com/sectool/112479.html">http://www.freebuf.com/sectool/112479.html</a>)</p>
<h2 id="hash-length-extension-attacks">hash length extension attacks<a class="headerlink" href="#hash-length-extension-attacks" title="Permanent link">&para;</a></h2>
<h3 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h3>
<p>The basic definition is as follows, from [Wikipedia] (<a href="https://en.wikipedia.org/wiki/%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6">https://en.wikipedia.org/wiki/%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6</a>% 94% BB% E5% 87% BB).</p>
<p>Hash Length Extension Attacks are pointers to certain cryptographic hash functions that allow additional information. This attack applies to all hash functions that take the H(key ∥ message) construct in the case where the length of the <strong> message and the key is known</strong>. Algorithms based on the Merkle–Damgård constructs such as MD5 and SHA-1 show vulnerabilities to such attacks.</p>
<p>This type of hash function has the following characteristics</p>
<ul>
<li>The message padding method is similar. First, add a 1 after the message, then fill in a number of 0s until the total length is congruent with 448, and finally attach a 64-bit message length (before filling).</li>
<li>Each link variable obtained will be used as the initial vector IV for the next execution of the hash function. In the last block, the corresponding link variable will be converted to a hash value.</li>
</ul>
<p>The following conditions should be met during a general attack.</p>
<ul>
<li>We know the length of the key, if you don&#39;t know, you need to burst it out.</li>
<li>We can control the message of the message.</li>
<li>We already know the hash value of a message containing a key.</li>
</ul>
<p>So we can get a pair (messge, x) to satisfy x = H (key ∥ message) although we are not sure about the contents of the key.</p>
<h3 id="attack-principle">Attack principle<a class="headerlink" href="#attack-principle" title="Permanent link">&para;</a></h3>
<p>Here we can assume that we know the hash value of hash(key+s), where s is known, then it will be filled when it is calculated. Then we can first get the key+s extended by key+s, ie</p>
<p>now=key|s|padding</p>
<p>Then if we attach a part of the information extra after the now, ie</p>
<p>key|s|padding|extra</p>
<p>When you go to calculate the hash value,</p>
<ol>
<li>The extra is filled until the condition is met.</li>
<li>Calculate the link variable IV1 corresponding to now, and we already know the hash value of this part, and the algorithm that the link variable produces the hash value is reversible, so we can get the link variable.</li>
<li>The hash algorithm is performed on the extra part according to the obtained link variable IV1, and the hash value is returned.</li>
</ol>
<p>So now that we know the hash value of the first part, and we also know the value of extra, then we can get the last hash value.</p>
<p>And before we said that we can control the value of the message. So in fact, s, padding, extra, we can all control. So we can naturally find the corresponding (message, x) to satisfy x = hash (key | mesage).</p>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<p>It seems that most of them are inside the web, and I don&#39;t know much about the web. I will not give examples for the time being.</p>
<h3 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/bwall/HashPump">hashpump</a></li>
</ul>
<p>Please refer to the readme on github for how to use it.</p>
<h2 id="hash-algorithm-is-incorrectly-designed">hash algorithm is incorrectly designed<a class="headerlink" href="#hash-algorithm-is-incorrectly-designed" title="Permanent link">&para;</a></h2>
<p>Some custom hash algorithms may be reversible.</p>
<h3 id="hashinator">Hashinator<a class="headerlink" href="#hashinator" title="Permanent link">&para;</a></h3>
<p>The logic of the topic is very simple. Pick a <code>password</code> from a well-known password dictionary &quot;rockyou&quot; and use a variety of hash algorithms to randomly hash 32 rounds. We need to crack the original <code>password</code> from the final hash result.</p>
<h4 id="analysis">Analysis<a class="headerlink" href="#analysis" title="Permanent link">&para;</a></h4>
<p>The hash algorithms used in the title are: <code>md5</code>, <code>sha1</code>, <code>blake</code>, <code>scrypt</code>.
The key code is as follows:
<div class="highlight"><pre><span></span><code>    <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_password</span><span class="p">()</span>     <span class="c1"># from rock_you.txt</span>

<span class="n">Salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_salt</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="c1"># related to the length of the password</span>
<span class="n">Hash_rounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_rounds</span><span class="p">()</span> <span class="c1"># Generate the order in which the hash algorithm is executed</span>
    <span class="n">password_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_hash</span><span class="p">(</span><span class="n">salt</span> <span class="o">+</span> <span class="n">password</span><span class="p">,</span> <span class="n">hash_rounds</span><span class="p">)</span>
</code></pre></div></p>
<ol>
<li>The program first randomly extracts a <code>password</code> from <code>rockyou.txt</code> as the encrypted plaintext.</li>
<li>Then generate a <code>salt</code> of length <code>128 - len(password)</code> based on the length of the extracted <code>password</code>.</li>
<li>Extract from the four hash algorithms listed above to form 32 rounds of hash operations.</li>
<li>Calculate the last <code>password_hash</code> given to us based on the previously obtained <code>password</code>, <code>salt</code>.</li>
</ol>
<p>Obviously, we can&#39;t complete the problem by the inverse hash algorithm.
We know all the possible plaintexts, first considering whether we can complete the exhaustion by constructing a rainbow table. But notice that in the <code>generate_salt()</code> function, the length combination of <code>salt</code> and <code>password</code> exceeds the length of 128 bytes and is annotated.
<div class="highlight"><pre><span></span><code>    msize = 128 # f-you hashcat :D
</code></pre></div></p>
<p>So, can only helplessly give up.</p>
<p>In that case, there is only one possibility, that is, the algorithm is reversible. Looking at the concrete implementation of the <code>calculate_hash()</code> function, you can find the following suspicious code:
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hash_rounds</span><span class="p">)):</span>

    <span class="n">interim_salt</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">interim_salt</span><span class="p">,</span> <span class="n">hash_rounds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">](</span><span class="n">interim_hash</span><span class="p">))</span>

    <span class="n">interim_hash</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">interim_hash</span><span class="p">,</span> <span class="n">hash_rounds</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">interim_salt</span><span class="p">))</span>

<span class="n">final_hash</span> <span class="o">=</span> <span class="n">interim_salt</span> <span class="o">+</span> <span class="n">interim_hash</span>
</code></pre></div></p>
<p>Reorganize the information we know:
1. There are 32 rounds stored in hash_rounds, which is the hash function handle to be used in each round.
2. final_hash is the last hash result for us.
3. The contents of hash_rounds will also be printed to us after generation.
4. We want to get the values of <code>interim_salt</code> and <code>interim_hash</code> in the first round.
5. <code>interim_salt</code> and <code>interim_hash</code> are both 64bytes in length.</p>
<p>A closer look at the calculations of <code>interim_salt</code> and <code>interim_hash</code> reveals that it is reversible.</p>
<p>$$</p>
<p>interim_hash_1 = interim_hash_2 \oplus hash_rounds<a href="interim_salt_3">i</a></p>
<p>$$</p>
<p>In this line of code, we know <span><span class="MathJax_Preview">interim\_hash_1</span><script type="math/tex">interim\_hash_1</script></span> and <span><span class="MathJax_Preview">interim\_salt_3</span><script type="math/tex">interim\_salt_3</script></span>, so we can get the value of <span><span class="MathJax_Preview">interim\_hash_2</span><script type="math/tex">interim\_hash_2</script></span>, and <span><span class="MathJax_Preview">interim\_hash_2</span><script type="math/tex">interim\_hash_2</script></span> is the last round of <code>interim_hash</code>.
By pushing back 32 times in this way, you can get the initial <code>password</code> and <code>salt</code>.</p>
<p>The specific decryption script is:
<div class="highlight"><pre><span></span><code><span class="kn">import</span>
<span class="nn">import</span> <span class="n">hashlib</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">import</span> <span class="nn">socketserver</span>

<span class="kn">import</span> <span class="nn">struct</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">threading</span>
<span class="c1"># import pyscrypt</span>

<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span><span class="p">,</span> <span class="n">b64decode</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">md5</span><span class="p">(</span><span class="n">bytestring</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">bytestring</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">sha</span><span class="p">(</span><span class="n">bytestring</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">bytestring</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">blake</span><span class="p">(</span><span class="n">bytestring</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">blake2b</span><span class="p">(</span><span class="n">bytestring</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">scrypt</span><span class="p">(</span><span class="n">bytestring</span><span class="p">):</span>

    <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bytestring</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">salt</span> <span class="o">=</span> <span class="n">bytestring</span><span class="p">[:</span><span class="n">l</span><span class="p">]</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">bytestring</span><span class="p">[</span><span class="n">l</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">scrypt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">salt</span><span class="o">=</span><span class="n">salt</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxmem</span><span class="o">=</span><span class="mi">67111936</span><span class="p">)</span>

    <span class="c1"># return pyscrypt.hash(p, salt, 2**16, 8, 1, dkLen=64)</span>

<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>

    <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">bytes</span><span class="p">([</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">s2</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">))])</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

<span class="c1"># io = socket.socket (family = socket.AF_INET)</span>
<span class="c1"># io.connect ((&amp;#39;47.88.216.38&amp;#39;, 20013))</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span> <span class="p">(</span><span class="o">&amp;</span><span class="c1">#39;47 .88.216.38 &amp;#39;, 20013)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span> <span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
    <span class="n">ans_array</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

<span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recv</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buf</span><span class="p">:</span>

            <span class="n">ans_array</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">buf</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;!&#39;</span><span class="p">:</span>

            <span class="k">break</span>



    <span class="n">password_hash_base64</span> <span class="o">=</span> <span class="n">ans_array</span><span class="p">[</span><span class="n">ans_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;b&#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="n">ans_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>

    <span class="n">password_hash</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">password_hash_base64</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;password:&#39;</span><span class="p">,</span> <span class="n">password_hash</span><span class="p">)</span>

    <span class="n">method_bytes</span> <span class="o">=</span> <span class="n">ans_array</span><span class="p">[</span>

        <span class="n">ans_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;used:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span> <span class="p">:</span> <span class="n">ans_array</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Your&#39;</span><span class="p">)</span>

    <span class="p">]</span>

    <span class="n">methods</span> <span class="o">=</span> <span class="n">method_bytes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;- &#39;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>

    <span class="n">in_salt</span> <span class="o">=</span> <span class="n">password_hash</span><span class="p">[:</span><span class="mi">64</span><span class="p">]</span>

    <span class="n">in_hash</span> <span class="o">=</span> <span class="n">password_hash</span><span class="p">[</span><span class="mi">64</span><span class="p">:]</span>

    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">neg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="n">methods</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>

        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">            interim_salt = xor(interim_salt, hash_rounds[-1-i](interim_hash))</span>

<span class="sd">            interim_hash = xor(interim_hash, hash_rounds[i](interim_salt))</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">in_hash</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">in_hash</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(in_salt)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">neg</span><span class="p">)))</span>

        <span class="n">in_salt</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">in_salt</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(in_hash)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="p">)))</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">in_hash</span><span class="p">,</span> <span class="n">in_salt</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">in_hash</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">:])</span>

<span class="n">io</span><span class="o">.</span><span class="n">interactive</span> <span class="p">()</span>
<span class="n">main</span><span class="p">()</span>
</code></pre></div></p>
<h4 id="original-hash-algorithm">Original hash algorithm<a class="headerlink" href="#original-hash-algorithm" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kn">import</span>
<span class="nn">import</span> <span class="n">hashlib</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">import</span> <span class="nn">socketserver</span>

<span class="kn">import</span> <span class="nn">struct</span>

<span class="kn">import</span> <span class="nn">time</span>



<span class="c1"># import pyscrypt</span>



<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>



<span class="k">def</span> <span class="nf">md5</span><span class="p">(</span><span class="n">bytestring</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">bytestring</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>



<span class="k">def</span> <span class="nf">sha</span><span class="p">(</span><span class="n">bytestring</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">bytestring</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>



<span class="k">def</span> <span class="nf">blake</span><span class="p">(</span><span class="n">bytestring</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">blake2b</span><span class="p">(</span><span class="n">bytestring</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>



<span class="k">def</span> <span class="nf">scrypt</span><span class="p">(</span><span class="n">bytestring</span><span class="p">):</span>

    <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bytestring</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">salt</span> <span class="o">=</span> <span class="n">bytestring</span><span class="p">[:</span><span class="n">l</span><span class="p">]</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">bytestring</span><span class="p">[</span><span class="n">l</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">scrypt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">salt</span><span class="o">=</span><span class="n">salt</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxmem</span><span class="o">=</span><span class="mi">67111936</span><span class="p">)</span>

    <span class="c1"># return pyscrypt.hash(p, salt, 2**16, 8, 1)</span>



<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>

    <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">bytes</span><span class="p">([</span><span class="n">s1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">s2</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">)]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">))])</span>



<span class="k">class</span> <span class="nc">HashHandler</span> <span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>


    <span class="n">welcome_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">Welcome, young wanna-be Cracker, to the Hashinator.</span>



<span class="s2">To prove your worthiness, you must display the power of your cracking skills.</span>



<span class="s2">The test is easy:</span>

<span class="s2">1. We send you a password from the rockyou list, hashed using multiple randomly chosen algorithms.</span>

<span class="s2">2. You crack the hash and send back the original password.</span>



<span class="s2">As you already know the dictionary and won&#39;t need any fancy password rules, </span><span class="si">{}</span><span class="s2"> seconds should be plenty, right?</span>



<span class="s2">Please wait while we generate your hash...</span>

<span class="s2">    &quot;&quot;&quot;</span>



    <span class="n">hashes</span> <span class="o">=</span> <span class="p">[</span><span class="n">md5</span><span class="p">,</span> <span class="n">sha</span><span class="p">,</span> <span class="n">blake</span><span class="p">,</span> <span class="n">scrypt</span><span class="p">]</span>

    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">total_rounds</span> <span class="o">=</span> <span class="mi">32</span>



    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">welcome_message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>



        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_password</span><span class="p">()</span>     <span class="c1"># from rock_you.txt</span>

<span class="n">Salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_salt</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="c1"># related to the length of the password</span>
<span class="n">Hash_rounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_rounds</span><span class="p">()</span> <span class="c1"># Generate the order in which the hash algorithm is executed</span>
        <span class="n">password_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_hash</span><span class="p">(</span><span class="n">salt</span> <span class="o">+</span> <span class="n">password</span><span class="p">,</span> <span class="n">hash_rounds</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_delay</span><span class="p">()</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;Challenge password hash: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b64encode</span><span class="p">(</span><span class="n">password_hash</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;Rounds used:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="n">test_rounds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">hash_rounds</span><span class="p">:</span>

            <span class="n">test_rounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>



        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">hash_rounds</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;- </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;Your time starts now!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">password</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;Congratulations! You are a true cracking master!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;Welcome to the club: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

                <span class="k">return</span>

        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>

            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;Your cracking skills are bad, and you should feel bad!&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>





    <span class="k">def</span> <span class="nf">generate_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rand</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="mi">14344391</span> <span class="c1"># size of rockyou</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">rand</span> <span class="o">%</span> <span class="n">lines</span>

        <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;rockyou.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>

            <span class="n">password</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">password</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>



    <span class="k">def</span> <span class="nf">generate_salt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>

        <span class="n">msize</span> <span class="o">=</span> <span class="mi">128</span> <span class="c1"># f-you hashcat :D</span>

        <span class="n">salt_size</span> <span class="o">=</span> <span class="n">msize</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">salt_size</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">generate_rounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rand</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">8</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">rounds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_rounds</span><span class="p">):</span>

            <span class="n">rounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hashes</span><span class="p">[</span><span class="n">rand</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hashes</span><span class="p">)])</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">rand</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">rounds</span>



    <span class="k">def</span> <span class="nf">calculate_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">hash_rounds</span><span class="p">):</span>

        <span class="n">interim_salt</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[:</span><span class="mi">64</span><span class="p">]</span>

        <span class="n">interim_hash</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">64</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hash_rounds</span><span class="p">)):</span>

            <span class="n">interim_salt</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">interim_salt</span><span class="p">,</span> <span class="n">hash_rounds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">](</span><span class="n">interim_hash</span><span class="p">))</span>

            <span class="n">interim_hash</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">interim_hash</span><span class="p">,</span> <span class="n">hash_rounds</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">interim_salt</span><span class="p">))</span>

            <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">            interim_hash = xor(</span>

<span class="sd">                interim_hash,</span>

<span class="sd">                hash_rounds[i](</span>

<span class="sd">                    xor(interim_salt, hash_rounds[-1-i](interim_hash))</span>

<span class="sd">                )</span>

<span class="sd">            )</span>

<span class="sd">            &#39;&#39;&#39;</span>

        <span class="n">final_hash</span> <span class="o">=</span> <span class="n">interim_salt</span> <span class="o">+</span> <span class="n">interim_hash</span>

        <span class="k">return</span> <span class="n">final_hash</span>



    <span class="k">def</span> <span class="nf">generate_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rand</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">rand</span> <span class="o">/</span> <span class="mf">1000000000.0</span><span class="p">)</span>







<span class="k">class</span> <span class="nc">ThreadedTCPServer</span><span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">ThreadingMixIn</span><span class="p">,</span> <span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">):</span>

    <span class="n">allow_reuse_address</span> <span class="o">=</span> <span class="kc">True</span>



<span class="n">PORT</span> <span class="o">=</span> <span class="mi">1337</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span>

<span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>



<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

    <span class="n">flag</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>



<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">ThreadedTCPServer</span> <span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">),</span> <span class="n">HashHandler</span><span class="p">)</span>
    <span class="n">server_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">)</span>

    <span class="n">server_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">server_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../js/base.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
        <script src="../../../../_static/js/extra.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.crypto/ctf-wiki/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
