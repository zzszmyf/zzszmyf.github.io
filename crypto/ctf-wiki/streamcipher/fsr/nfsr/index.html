<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../img/favicon.ico">
        <title>非线性反馈移位寄存器 - 西山下,闻溪语,书心境</title>
    <link href="../../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../../js/jquery-1.10.2.min.js" defer></script>
    <script src="../../../../../js/bootstrap-3.3.7.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../../..">西山下,闻溪语,书心境</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Index <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../.." class="dropdown-item">首页</a>
</li>
                                    
<li>
    <a href="../../../../../about/" class="dropdown-item">关于我</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Crypto <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">ctf-wiki中的资料</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../introduction/" class="dropdown-item">密码学简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">基础数学知识</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../basic/introduction/" class="dropdown-item">简介</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">古典密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../classical/introduction/" class="dropdown-item">古典密码简介</a>
</li>
            
<li>
    <a href="../../../classical/monoalphabetic/" class="dropdown-item">单表代换加密</a>
</li>
            
<li>
    <a href="../../../classical/polyalphabetic/" class="dropdown-item">多表代换加密</a>
</li>
            
<li>
    <a href="../../../classical/others/" class="dropdown-item">其他类型加密</a>
</li>
            
<li>
    <a href="../../../classical/summary/" class="dropdown-item">总结</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../intro/" class="dropdown-item">介绍</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">伪随机数生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../prng/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../prng/csprng/" class="dropdown-item">密码学安全伪随机数生成器</a>
</li>
            
<li>
    <a href="../../prng/problem/" class="dropdown-item">题目</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">线性同余生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../lcg/intro/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../lcg/challenge/" class="dropdown-item">例题</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">反馈移位寄存器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../lfsr/" class="dropdown-item">线性反馈移位寄存器</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">非线性反馈移位寄存器</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">特殊流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../special/rc4/" class="dropdown-item">RC4</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">块加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../blockcipher/introduction/" class="dropdown-item">块加密简介</a>
</li>
            
<li>
    <a href="../../../blockcipher/arx-operations/" class="dropdown-item">ARX</a>
</li>
            
<li>
    <a href="../../../blockcipher/des/" class="dropdown-item">DES</a>
</li>
            
<li>
    <a href="../../../blockcipher/idea/" class="dropdown-item">IDEA</a>
</li>
            
<li>
    <a href="../../../blockcipher/aes.md" class="dropdown-item">AES</a>
</li>
            
<li>
    <a href="../../../blockcipher/simon-speck/" class="dropdown-item">Simon and Speck</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">分组模式</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../blockcipher/mode/introduction/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/padding/" class="dropdown-item">填充方式</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ecb/" class="dropdown-item">ECB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/cbc/" class="dropdown-item">CBC</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/pcbc/" class="dropdown-item">PCBC</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/cfb/" class="dropdown-item">CFB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ofb/" class="dropdown-item">OFB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ctr/" class="dropdown-item">CTR</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/padding-oracle-attack/" class="dropdown-item">Padding Oracle Attack</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">非对称加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../asymmetric/introduction/" class="dropdown-item">非对称加密简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">RSA</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../asymmetric/rsa/rsa_theory/" class="dropdown-item">RSA 基本介绍</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_module_attack/" class="dropdown-item">模数相关攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_e_attack/" class="dropdown-item">公钥指数相关攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_d_attack/" class="dropdown-item">私钥 d 相关攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_coppersmith_attack.md" class="dropdown-item">Coppersmith 相关攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_chosen_plain_cipher/" class="dropdown-item">选择明密文攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_side_channel/" class="dropdown-item">侧信道攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_pkcs_attack/" class="dropdown-item">Bleichenbacher 攻击</a>
</li>
            
<li>
    <a href="../../../asymmetric/rsa/rsa_complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../asymmetric/knapsack/knapsack/" class="dropdown-item">背包加密</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">离散对数相关</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../asymmetric/discrete-log/discrete-log/" class="dropdown-item">离散对数</a>
</li>
            
<li>
    <a href="../../../asymmetric/discrete-log/elgamal/" class="dropdown-item">Elgamal</a>
</li>
            
<li>
    <a href="../../../asymmetric/discrete-log/ecc/" class="dropdown-item">ECC</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">格密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../asymmetric/lattice/overview/" class="dropdown-item">格概述</a>
</li>
            
<li>
    <a href="../../../asymmetric/lattice/introduction/" class="dropdown-item">格介绍</a>
</li>
            
<li>
    <a href="../../../asymmetric/lattice/lattice-reduction/" class="dropdown-item">格基规约算法</a>
</li>
            
<li>
    <a href="../../../asymmetric/lattice/cvp/" class="dropdown-item">CVP</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">哈希函数</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../hash/introduction/" class="dropdown-item">哈希函数简介</a>
</li>
            
<li>
    <a href="../../../hash/md5/" class="dropdown-item">MD5</a>
</li>
            
<li>
    <a href="../../../hash/sha1/" class="dropdown-item">SHA1</a>
</li>
            
<li>
    <a href="../../../hash/fnv/" class="dropdown-item">FNV</a>
</li>
            
<li>
    <a href="../../../hash/attack/" class="dropdown-item">Hash Attack</a>
</li>
            
<li>
    <a href="../../../hash/complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">数字签名</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../signature/introduction/" class="dropdown-item">数字签名简介</a>
</li>
            
<li>
    <a href="../../../signature/rsa/" class="dropdown-item">RSA 数字签名</a>
</li>
            
<li>
    <a href="../../../signature/elgamal.md" class="dropdown-item">ElGamal 数字签名</a>
</li>
            
<li>
    <a href="../../../signature/dsa/" class="dropdown-item">DSA 数字签名</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">攻击思想总结</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../attack-summary/attack-mode/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../../attack-summary/meet-in-the-middle/" class="dropdown-item">中间相遇攻击</a>
</li>
            
<li>
    <a href="../../../attack-summary/bit-attack/" class="dropdown-item">比特攻击</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../lfsr/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../special/rc4/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#feedback-shift-register" class="nav-link">非反馈 feedback shift register</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#nonlinear-combination-generator" class="nav-link">Nonlinear Combination Generator</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#topic" class="nav-link">topic</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#reference" class="nav-link">Reference</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="./">EN</a> | <a href="../nfsr-zh/">ZH</a></p>
<h1 id="feedback-shift-register">非反馈 feedback shift register<a class="headerlink" href="#feedback-shift-register" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In order to make the sequence of key stream output as complex as possible, a nonlinear feedback shift register is used. There are three common types.</p>
<ul>
<li>Nonlinear combination generator that uses a nonlinear combination function for the output of multiple LFSRs</li>
<li>Nonlinear filter generator that uses a nonlinear combination function for the contents of an LFSR</li>
<li>Clock generator that uses the output of one (or more) LFSRs to control the clock of another (or multiple) LFSRs</li>
</ul>
<h2 id="nonlinear-combination-generator">Nonlinear Combination Generator<a class="headerlink" href="#nonlinear-combination-generator" title="Permanent link">&para;</a></h2>
<h3 id="introduction_1">Introduction<a class="headerlink" href="#introduction_1" title="Permanent link">&para;</a></h3>
<p>The combination generator is generally shown below.</p>
<p><img alt="image-20180713223743681" src="../figure/combine-generator.png" /></p>
<h3 id="geffe">Geffe<a class="headerlink" href="#geffe" title="Permanent link">&para;</a></h3>
<p>Here we take Geffe as an example. Geffe contains 3 linear feedback shift registers, and the nonlinear combination function is</p>
<div>
<div class="MathJax_Preview">F(x_1,x_2,x_3)=(x_1 \and x_2) \oplus (\urcorner x_1 \and x_3)=(x_1 \and x_2) \oplus ( x_1 \and x_3)\oplus x_3</div>
<script type="math/tex; mode=display">F(x_1,x_2,x_3)=(x_1 \and x_2) \oplus (\urcorner x_1 \and x_3)=(x_1 \and x_2) \oplus ( x_1 \and x_3)\oplus x_3</script>
</div>
<h4 id="2018-strong-net-cup-streamgame3">2018 Strong Net Cup streamgame3<a class="headerlink" href="#2018-strong-net-cup-streamgame3" title="Permanent link">&para;</a></h4>
<p>Simply look at the topic</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flag</span> <span class="kn">import</span> <span class="n">flag</span>

<span class="k">assert</span> <span class="n">flag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;flag{&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">flag</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">==</span><span class="mi">24</span>



<span class="k">def</span> <span class="nf">lfsr</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">mask</span><span class="p">):</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffff</span>

    <span class="n">i</span><span class="o">=</span><span class="p">(</span><span class="n">R</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffff</span>

    <span class="n">lastbit</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">while</span> <span class="n">i</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>

        <span class="n">lastbit</span><span class="o">^=</span><span class="p">(</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">1</span>

    <span class="n">output</span><span class="o">^=</span><span class="n">lastbit</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="n">lastbit</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">single_round</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span><span class="n">R1_mask</span><span class="p">,</span><span class="n">R2</span><span class="p">,</span><span class="n">R2_mask</span><span class="p">,</span><span class="n">R3</span><span class="p">,</span><span class="n">R3_mask</span><span class="p">):</span>

    <span class="p">(</span><span class="n">R1_NEW</span><span class="p">,</span><span class="n">x1</span><span class="p">)</span><span class="o">=</span><span class="n">lfsr</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span><span class="n">R1_mask</span><span class="p">)</span>

    <span class="p">(</span><span class="n">R2_NEW</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span><span class="o">=</span><span class="n">lfsr</span><span class="p">(</span><span class="n">R2</span><span class="p">,</span><span class="n">R2_mask</span><span class="p">)</span>

    <span class="p">(</span><span class="n">R3_NEW</span><span class="p">,</span><span class="n">x3</span><span class="p">)</span><span class="o">=</span><span class="n">lfsr</span><span class="p">(</span><span class="n">R3</span><span class="p">,</span><span class="n">R3_mask</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">R1_NEW</span><span class="p">,</span><span class="n">R2_NEW</span><span class="p">,</span><span class="n">R3_NEW</span><span class="p">,(</span><span class="n">x1</span><span class="o">*</span><span class="n">x2</span><span class="p">)</span><span class="o">^</span><span class="p">((</span><span class="n">x2</span><span class="o">^</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x3</span><span class="p">))</span>



<span class="n">R1</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">11</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>

<span class="n">R2</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">17</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>

<span class="n">R3</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">23</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span> <span class="p">(</span><span class="nb">bin</span> <span class="p">(</span><span class="n">R1</span><span class="p">)</span> <span class="p">[</span><span class="mi">2</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">17</span>
<span class="k">assert</span> <span class="nb">len</span> <span class="p">(</span><span class="nb">bin</span> <span class="p">(</span><span class="n">R2</span><span class="p">)</span> <span class="p">[</span><span class="mi">2</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">19</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="n">R3</span><span class="p">)[</span><span class="mi">2</span><span class="p">:])</span><span class="o">==</span><span class="mi">21</span>

<span class="n">R1_mask</span><span class="o">=</span><span class="mh">0x10020</span>

<span class="n">R2_mask</span><span class="o">=</span><span class="mh">0x4100c</span>

<span class="n">R3_mask</span><span class="o">=</span><span class="mh">0x100002</span>





<span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>

<span class="nb">print</span> <span class="n">fi</span>
<span class="n">tmp1mb</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>

<span class="n">tmp1kb</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>

            <span class="n">tmp</span><span class="o">=</span><span class="mi">0</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>

                <span class="p">(</span><span class="n">R1</span><span class="p">,</span><span class="n">R2</span><span class="p">,</span><span class="n">R3</span><span class="p">,</span><span class="n">out</span><span class="p">)</span><span class="o">=</span><span class="n">single_round</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span><span class="n">R1_mask</span><span class="p">,</span><span class="n">R2</span><span class="p">,</span><span class="n">R2_mask</span><span class="p">,</span><span class="n">R3</span><span class="p">,</span><span class="n">R3_mask</span><span class="p">)</span>

                <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">out</span>

            <span class="n">tmp1kb</span><span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

<span class="n">tmp1mb</span> <span class="o">+</span> <span class="o">=</span> <span class="n">tmp1kb</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./output/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fi</span><span class="p">),</span> <span class="s2">&quot;ab&quot;</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tmp1mb</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p>It can be seen that the program is very similar to the Geffe generator. Here we use the related attack method to attack. We can count the output of the last class Geffe generator when the three LFSR outputs are different, as follows.</p>
<p>| <span><span class="MathJax_Preview">x_1</span><script type="math/tex">x_1</script></span> | <span><span class="MathJax_Preview">x_2</span><script type="math/tex">x_2</script></span> | <span><span class="MathJax_Preview">x_3</span><script type="math/tex">x_3</script></span> | <span><span class="MathJax_Preview">F(x_1,x_2,x_3)</span><script type="math/tex">F(x_1,x_2,x_3)</script></span> |</p>
<p>| ----- | ----- | ----- | ---------------- |</p>
<p>| 0     | 0     | 0     | 0                |</p>
<p>| 0     | 0     | 1     | 1                |</p>
<p>| 0     | 1     | 0     | 0                |</p>
<p>| 0     | 1     | 1     | 0                |</p>
<p>| 1     | 0     | 0     | 0                |</p>
<p>| 1     | 0     | 1     | 1                |</p>
<p>| 1     | 1     | 0     | 1                |</p>
<p>| 1     | 1     | 1     | 1                |</p>
<p>it can be discovered</p>
<ul>
<li>Geffe&#39;s output has the same probability as <span><span class="MathJax_Preview">x_1</span><script type="math/tex">x_1</script></span> 0.75</li>
<li>Geffe&#39;s output has the same probability of <span><span class="MathJax_Preview">x_2</span><script type="math/tex">x_2</script></span> as 0.5</li>
<li>Geffe&#39;s output has the same probability of <span><span class="MathJax_Preview">x_3</span><script type="math/tex">x_3</script></span> as 0.75</li>
</ul>
<p>This shows that the output is very relevant to the first and third. Therefore, we can violently enumerate the output of the first and third LFSRs to determine the number equal to the output of Geffe-like, and if it is about 75%, it can be considered correct. The second is a direct violent enumeration.</p>
<p>The script is as follows</p>
<div class="highlight"><pre><span></span><code><span class="c1">#for x1 in range(2):</span>

<span class="c1">#    for x2 in range(2):</span>

<span class="c1">#        for x3 in range(2):</span>

<span class="c1">#            print x1,x2,x3,(x1*x2)^((x2^1)*x3)</span>

<span class="c1">#n = [17,19,21]</span>



<span class="c1">#cycle = 1</span>

<span class="c1">#for i in n:</span>

<span class="c1">#    cycle = cycle*(pow(2,i)-1)</span>

<span class="c1">#print cycle</span>





<span class="k">def</span> <span class="nf">lfsr</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffff</span>

    <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffff</span>

    <span class="n">lastbit</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">lastbit</span> <span class="o">^=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>

    <span class="n">output</span> <span class="o">^=</span> <span class="n">lastbit</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">lastbit</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">single_round</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R1_mask</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R2_mask</span><span class="p">,</span> <span class="n">R3</span><span class="p">,</span> <span class="n">R3_mask</span><span class="p">):</span>
    <span class="p">(</span><span class="n">R1_NEW</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span> <span class="o">=</span> <span class="n">lfsr</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R1_mask</span><span class="p">)</span>

    <span class="p">(</span><span class="n">R2_NEW</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span> <span class="o">=</span> <span class="n">lfsr</span><span class="p">(</span><span class="n">R2</span><span class="p">,</span> <span class="n">R2_mask</span><span class="p">)</span>

    <span class="p">(</span><span class="n">R3_NEW</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span> <span class="o">=</span> <span class="n">lfsr</span><span class="p">(</span><span class="n">R3</span><span class="p">,</span> <span class="n">R3_mask</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">R1_NEW</span><span class="p">,</span> <span class="n">R2_NEW</span><span class="p">,</span> <span class="n">R3_NEW</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span><span class="p">)</span> <span class="o">^</span> <span class="p">((</span><span class="n">x2</span> <span class="o">^</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x3</span><span class="p">))</span>





<span class="n">R1_mask</span> <span class="o">=</span> <span class="mh">0x10020</span>

<span class="n">R2_mask</span> <span class="o">=</span> <span class="mh">0x4100c</span>

<span class="n">R3_mask</span> <span class="o">=</span> <span class="mh">0x100002</span>

<span class="n">n3</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">n2</span> <span class="o">=</span> <span class="mi">19</span>
<span class="n">n1</span> <span class="o">=</span> <span class="mi">17</span>




<span class="k">def</span> <span class="nf">guess</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>

    <span class="n">ansn</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./output/0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">now</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">true</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ansn</span><span class="p">:</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">i</span>

        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span> <span class="o">*</span> <span class="mi">8</span><span class="p">):</span>

            <span class="n">r</span><span class="p">,</span> <span class="n">lastbit</span> <span class="o">=</span> <span class="n">lfsr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

            <span class="n">lastbit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lastbit</span><span class="p">)</span>

            <span class="n">cnt</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lastbit</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">:</span>

            <span class="n">now</span> <span class="o">=</span> <span class="n">cnt</span>

            <span class="n">res</span> <span class="o">=</span> <span class="n">i</span>

            <span class="nb">print</span> <span class="n">now</span><span class="p">,</span> <span class="n">res</span>

    <span class="k">return</span> <span class="n">res</span>





<span class="k">def</span> <span class="nf">bruteforce2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>

    <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./output/0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n2</span><span class="p">)):</span>

        <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R3</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>

        <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>

<span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R3</span><span class="p">,</span>
             <span class="n">out</span><span class="p">)</span> <span class="o">=</span> <span class="n">single_round</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R1_mask</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R2_mask</span><span class="p">,</span> <span class="n">R3</span><span class="p">,</span> <span class="n">R3_mask</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>

                <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">break</span>

        <span class="k">if</span> <span class="n">y</span> <span class="o">%</span> <span class="mi">10000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="nb">print</span> <span class="s1">&#39;now: &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>

        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>

            <span class="nb">print</span> <span class="s1">&#39;ans: &#39;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">2</span><span class="p">:],</span> <span class="nb">hex</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">2</span><span class="p">:],</span> <span class="nb">hex</span><span class="p">(</span><span class="n">z</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>

            <span class="k">break</span>





<span class="n">R1</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n1</span><span class="p">),</span> <span class="mi">40</span><span class="p">,</span> <span class="n">R1_mask</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">R1</span>

<span class="n">R3</span> <span class="o">=</span> <span class="n">guess</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n3</span><span class="p">),</span> <span class="mi">40</span><span class="p">,</span> <span class="n">R3_mask</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">R3</span>

<span class="n">R1</span> <span class="o">=</span> <span class="mi">113099</span>
<span class="n">R3</span> <span class="o">=</span> <span class="mi">1487603</span>


<span class="n">bruteforce2</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R3</span><span class="p">)</span>
</code></pre></div>

<p>The results are as follows</p>
<div class="highlight"><pre><span></span><code>➜  <span class="m">2018</span>-CISCN-start-streamgame3 git:<span class="o">(</span>master<span class="o">)</span> ✗ python exp.py

<span class="m">161</span> <span class="m">65536</span>

<span class="m">172</span> <span class="m">65538</span>

<span class="m">189</span> <span class="m">65545</span>

<span class="m">203</span> <span class="m">65661</span>

<span class="m">210</span> <span class="m">109191</span>

<span class="m">242</span> <span class="m">113099</span>

<span class="m">113099</span>

<span class="m">157</span> <span class="m">1048576</span>

<span class="m">165</span> <span class="m">1048578</span>

<span class="m">183</span> <span class="m">1048580</span>

<span class="m">184</span> <span class="m">1049136</span>

<span class="m">186</span> <span class="m">1049436</span>

<span class="m">187</span> <span class="m">1049964</span>

<span class="m">189</span> <span class="m">1050869</span>

<span class="m">190</span> <span class="m">1051389</span>

<span class="m">192</span> <span class="m">1051836</span>

<span class="m">194</span> <span class="m">1053573</span>

<span class="m">195</span> <span class="m">1055799</span>

<span class="m">203</span> <span class="m">1060961</span>

<span class="m">205</span> <span class="m">1195773</span>

<span class="m">212</span> <span class="m">1226461</span>

<span class="m">213</span> <span class="m">1317459</span>

<span class="m">219</span> <span class="m">1481465</span>

<span class="m">239</span> <span class="m">1487603</span>

<span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">270000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">280000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">290000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">300000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">310000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">320000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">330000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">340000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">350000</span> <span class="m">1487603</span>

now:  <span class="m">113099</span> <span class="m">360000</span> <span class="m">1487603</span>

years old: 1b9cb 5979c 16b2f3
</code></pre></div>

<p>Thus flag is flag{01b9cb05979c16b2f3}.</p>
<h2 id="topic">topic<a class="headerlink" href="#topic" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>2017 WHCTF Bornpig</p>
</li>
<li>
<p>2018 Google CTF 2018 Betterzip</p>
</li>
</ul>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><a href="https://www.rocq.inria.fr/secret/Anne.Canteaut/MPRI/chapter3.pdf">https://www.rocq.inria.fr/secret/Anne.Canteaut/MPRI/chapter3.pdf</a></p>
</li>
<li>
<p><a href="http://data.at.preempted.net/INDEX/articles/Correlation_Attacks_Geffe.pdf">http://data.at.preempted.net/INDEX/articles/Correlation_Attacks_Geffe.pdf</a></p>
</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../../js/base.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
        <script src="../../../../../_static/js/extra.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.crypto/ctf-wiki/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
