<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../img/favicon.ico">
        <title>RSA 基本介绍 - 西山下,闻溪语,书心境</title>
        <link href="../../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../../..">西山下,闻溪语,书心境</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Index <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../.." class="dropdown-item">首页</a>
</li>
                                    
<li>
    <a href="../../../../../about/" class="dropdown-item">关于我</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Crypto <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">ctf-wiki中的资料</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../introduction/" class="dropdown-item">密码学简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">基础数学知识</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../basic/introduction/" class="dropdown-item">简介</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">古典密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../classical/introduction/" class="dropdown-item">古典密码简介</a>
</li>
            
<li>
    <a href="../../../classical/monoalphabetic/" class="dropdown-item">单表代换加密</a>
</li>
            
<li>
    <a href="../../../classical/polyalphabetic/" class="dropdown-item">多表代换加密</a>
</li>
            
<li>
    <a href="../../../classical/others/" class="dropdown-item">其他类型加密</a>
</li>
            
<li>
    <a href="../../../classical/summary/" class="dropdown-item">总结</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/intro/" class="dropdown-item">介绍</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">伪随机数生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/prng/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../streamcipher/prng/csprng/" class="dropdown-item">密码学安全伪随机数生成器</a>
</li>
            
<li>
    <a href="../../../streamcipher/prng/problem/" class="dropdown-item">题目</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">线性同余生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/lcg/intro/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../../streamcipher/lcg/challenge/" class="dropdown-item">例题</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">反馈移位寄存器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/fsr/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../streamcipher/fsr/lfsr/" class="dropdown-item">线性反馈移位寄存器</a>
</li>
            
<li>
    <a href="../../../streamcipher/fsr/nfsr/" class="dropdown-item">非线性反馈移位寄存器</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">特殊流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/special/rc4/" class="dropdown-item">RC4</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">块加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../blockcipher/introduction/" class="dropdown-item">块加密简介</a>
</li>
            
<li>
    <a href="../../../blockcipher/arx-operations/" class="dropdown-item">ARX</a>
</li>
            
<li>
    <a href="../../../blockcipher/des/" class="dropdown-item">DES</a>
</li>
            
<li>
    <a href="../../../blockcipher/idea/" class="dropdown-item">IDEA</a>
</li>
            
<li>
    <a href="../../../blockcipher/aes.md" class="dropdown-item">AES</a>
</li>
            
<li>
    <a href="../../../blockcipher/simon-speck/" class="dropdown-item">Simon and Speck</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">分组模式</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../blockcipher/mode/introduction/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/padding/" class="dropdown-item">填充方式</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ecb/" class="dropdown-item">ECB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/cbc/" class="dropdown-item">CBC</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/pcbc/" class="dropdown-item">PCBC</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/cfb/" class="dropdown-item">CFB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ofb/" class="dropdown-item">OFB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ctr/" class="dropdown-item">CTR</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/padding-oracle-attack/" class="dropdown-item">Padding Oracle Attack</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">非对称加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../introduction/" class="dropdown-item">非对称加密简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">RSA</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">RSA 基本介绍</a>
</li>
            
<li>
    <a href="../rsa_module_attack/" class="dropdown-item">模数相关攻击</a>
</li>
            
<li>
    <a href="../rsa_e_attack/" class="dropdown-item">公钥指数相关攻击</a>
</li>
            
<li>
    <a href="../rsa_d_attack/" class="dropdown-item">私钥 d 相关攻击</a>
</li>
            
<li>
    <a href="../rsa_coppersmith_attack.md" class="dropdown-item">Coppersmith 相关攻击</a>
</li>
            
<li>
    <a href="../rsa_chosen_plain_cipher/" class="dropdown-item">选择明密文攻击</a>
</li>
            
<li>
    <a href="../rsa_side_channel/" class="dropdown-item">侧信道攻击</a>
</li>
            
<li>
    <a href="../rsa_pkcs_attack/" class="dropdown-item">Bleichenbacher 攻击</a>
</li>
            
<li>
    <a href="../rsa_complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../knapsack/knapsack/" class="dropdown-item">背包加密</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">离散对数相关</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../discrete-log/discrete-log/" class="dropdown-item">离散对数</a>
</li>
            
<li>
    <a href="../../discrete-log/elgamal/" class="dropdown-item">Elgamal</a>
</li>
            
<li>
    <a href="../../discrete-log/ecc/" class="dropdown-item">ECC</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">格密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../lattice/overview/" class="dropdown-item">格概述</a>
</li>
            
<li>
    <a href="../../lattice/introduction/" class="dropdown-item">格介绍</a>
</li>
            
<li>
    <a href="../../lattice/lattice-reduction/" class="dropdown-item">格基规约算法</a>
</li>
            
<li>
    <a href="../../lattice/cvp/" class="dropdown-item">CVP</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">哈希函数</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../hash/introduction/" class="dropdown-item">哈希函数简介</a>
</li>
            
<li>
    <a href="../../../hash/md5/" class="dropdown-item">MD5</a>
</li>
            
<li>
    <a href="../../../hash/sha1/" class="dropdown-item">SHA1</a>
</li>
            
<li>
    <a href="../../../hash/fnv/" class="dropdown-item">FNV</a>
</li>
            
<li>
    <a href="../../../hash/attack/" class="dropdown-item">Hash Attack</a>
</li>
            
<li>
    <a href="../../../hash/complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">数字签名</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../signature/introduction/" class="dropdown-item">数字签名简介</a>
</li>
            
<li>
    <a href="../../../signature/rsa/" class="dropdown-item">RSA 数字签名</a>
</li>
            
<li>
    <a href="../../../signature/elgamal.md" class="dropdown-item">ElGamal 数字签名</a>
</li>
            
<li>
    <a href="../../../signature/dsa/" class="dropdown-item">DSA 数字签名</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">攻击思想总结</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../attack-summary/attack-mode/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../../attack-summary/meet-in-the-middle/" class="dropdown-item">中间相遇攻击</a>
</li>
            
<li>
    <a href="../../../attack-summary/bit-attack/" class="dropdown-item">比特攻击</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../introduction/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../rsa_module_attack/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#rsa-introduction" class="nav-link">RSA Introduction</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#fundamental" class="nav-link">Fundamental</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#basic-tools" class="nav-link">Basic Tools</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#jarvis-oj-basic-veryeasyrsa" class="nav-link">Jarvis OJ - Basic - veryeasyRSA</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2018-codegate-ctf-rsababy" class="nav-link">2018 CodeGate CTF Rsababy</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2018-national-security-week-pure-math" class="nav-link">2018 National Security Week pure math</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2018-pwnhub-lhy" class="nav-link">2018 Pwnhub LHY</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="./">EN</a> | <a href="../rsa_theory-zh/">ZH</a></p>
<h1 id="rsa-introduction">RSA Introduction<a class="headerlink" href="#rsa-introduction" title="Permanent link">&para;</a></h1>
<p>The RSA encryption algorithm is an asymmetric encryption algorithm. RSA is widely used in public key encryption and electronic commerce. The RSA was proposed in 1977 by Ron Rivest, Adi Shamir, and Leonard Adleman. The RSA is composed of the letters of the three names of the three of them.</p>
<p>The reliability of the RSA algorithm is determined by the difficulty of maximizing integer factorization. In other words, the more difficult it is to factorize a very large integer, the more reliable the RSA algorithm is. If someone finds a fast factorization algorithm, the reliability of the information encrypted with RSA will definitely drop. But the possibility of finding such an algorithm is very small. Today, only short RSA keys can be broken down in a powerful way. As of 2017, there is no reliable way to attack the RSA algorithm.</p>
<h2 id="fundamental">Fundamental<a class="headerlink" href="#fundamental" title="Permanent link">&para;</a></h2>
<h3 id="public-key-and-private-key-generation">Public key and private key generation<a class="headerlink" href="#public-key-and-private-key-generation" title="Permanent link">&para;</a></h3>
<ol>
<li>Randomly select two different large prime numbers <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> and <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> to calculate <span><span class="MathJax_Preview">N = p \times q</span><script type="math/tex">N = p \times q</script></span></li>
<li>According to the Euler function, find <span><span class="MathJax_Preview">\varphi (N)=\varphi (p)\varphi (q)=(p-1)(q-1)</span><script type="math/tex">\varphi (N)=\varphi (p)\varphi (q)=(p-1)(q-1)</script></span></li>
<li>Select an integer <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span> that is less than <span><span class="MathJax_Preview">\varphi (N)</span><script type="math/tex">\varphi (N)</script></span> to make <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span> and <span><span class="MathJax_Preview">\varphi (N)</span><script type="math/tex">\varphi (N)</script></span> mutually prime. And ask for <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span> about the inverse of <span><span class="MathJax_Preview">\varphi (N)</span><script type="math/tex">\varphi (N)</script></span>, named <span><span class="MathJax_Preview">d</span><script type="math/tex">d</script></span>, with <span><span class="MathJax_Preview">ed\equiv 1 \pmod {\varphi (N)}</span><script type="math/tex">ed\equiv 1 \pmod {\varphi (N)}</script></span></li>
<li>Destroy records of <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> and <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span></li>
</ol>
<p>At this point, <span><span class="MathJax_Preview">(N,e)</span><script type="math/tex">(N,e)</script></span> is the public key and <span><span class="MathJax_Preview">(N,d)</span><script type="math/tex">(N,d)</script></span> is the private key.</p>
<h3 id="message-encryption">Message Encryption<a class="headerlink" href="#message-encryption" title="Permanent link">&para;</a></h3>
<p>First, we need to convert the message into an integer <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> using an agreed-upon protocol, such than <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> is less than <span><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span> and <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> is coprime to <span><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span>. If the message is too long, we can divide the message into several segments, which is what we call block encryption, and then encrypt each part with the following formula:</p>
<div>
<div class="MathJax_Preview">
m^{e}\equiv c\pmod N
</div>
<script type="math/tex; mode=display">
m^{e}\equiv c\pmod N
</script>
</div>
<h3 id="message-decryption">Message decryption<a class="headerlink" href="#message-decryption" title="Permanent link">&para;</a></h3>
<p>Use the private key <span><span class="MathJax_Preview">d</span><script type="math/tex">d</script></span> to decrypt the message.</p>
<div>
<div class="MathJax_Preview">
c^{d}\equiv m\pmod N
</div>
<script type="math/tex; mode=display">
c^{d}\equiv m\pmod N
</script>
</div>
<h3 id="verification">Verification<a class="headerlink" href="#verification" title="Permanent link">&para;</a></h3>
<p>To verify <span><span class="MathJax_Preview">m^{ed} \equiv m \bmod N</span><script type="math/tex">m^{ed} \equiv m \bmod N</script></span>, we use the fact that <span><span class="MathJax_Preview">ed \equiv 1 \bmod \phi(N)</span><script type="math/tex">ed \equiv 1 \bmod \phi(N)</script></span>, then <span><span class="MathJax_Preview">ed=k\phi(N)+1</span><script type="math/tex">ed=k\phi(N)+1</script></span>, it is sufficient to prove that</p>
<div>
<div class="MathJax_Preview">
m^{k\phi(N)+1} \equiv m \bmod N
</div>
<script type="math/tex; mode=display">
m^{k\phi(N)+1} \equiv m \bmod N
</script>
</div>
<p>We will prove it by considering two seperate cases</p>
<p>In the first case, <span><span class="MathJax_Preview">gcd(m,N)=1</span><script type="math/tex">gcd(m,N)=1</script></span>, hence <span><span class="MathJax_Preview">m^{\phi(N)} \equiv 1 \bmod N</span><script type="math/tex">m^{\phi(N)} \equiv 1 \bmod N</script></span>, so the original claim is true.</p>
<p>In the second case, <span><span class="MathJax_Preview">gcd(m,N)\neq 1</span><script type="math/tex">gcd(m,N)\neq 1</script></span>, so <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> must be a multiple of <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> or <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span>, and since <span><span class="MathJax_Preview">n=m</span><script type="math/tex">n=m</script></span> is less than <span><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span>, we can assume that</p>
<div>
<div class="MathJax_Preview">
m = xp
</div>
<script type="math/tex; mode=display">
m = xp
</script>
</div>
<p>Where <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> must be less than <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span>. Since <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> is a prime number,</p>
<div>
<div class="MathJax_Preview">
m^{\phi(q)}\equiv 1 \bmod q
</div>
<script type="math/tex; mode=display">
m^{\phi(q)}\equiv 1 \bmod q
</script>
</div>
<div>
<div class="MathJax_Preview">
m^{k\phi(N)} = m {k(p-1)(q-1)} = (m^{\phi(q)})^{k(p-1)} \equiv 1 \bmod q
</div>
<script type="math/tex; mode=display">
m^{k\phi(N)} = m {k(p-1)(q-1)} = (m^{\phi(q)})^{k(p-1)} \equiv 1 \bmod q
</script>
</div>
<div>
<div class="MathJax_Preview">
m^{k\phi(N)+1}=m+uqm
</div>
<script type="math/tex; mode=display">
m^{k\phi(N)+1}=m+uqm
</script>
</div>
<div>
<div class="MathJax_Preview">
m^{k\phi(N)+1}=m+uqxp=m+uxN
</div>
<script type="math/tex; mode=display">
m^{k\phi(N)+1}=m+uqxp=m+uxN
</script>
</div>
<p>Hence it is proven to be correct.</p>
<h2 id="basic-tools">Basic Tools<a class="headerlink" href="#basic-tools" title="Permanent link">&para;</a></h2>
<h3 id="rsatool">RSAtool<a class="headerlink" href="#rsatool" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Installation</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/ius/rsatool.git
<span class="nb">cd</span> rsatool
python rsatool.py -h
</code></pre></div>

</li>
<li>
<p>Generate private key</p>
<div class="highlight"><pre><span></span><code>Python rsatool.py f FEM private.pem o p q <span class="m">1234567</span> <span class="m">7654321</span>
</code></pre></div>

</li>
</ul>
<h3 id="rsa-converter">RSA Converter<a class="headerlink" href="#rsa-converter" title="Permanent link">&para;</a></h3>
<ul>
<li>Generate a pem file based on a given key pair</li>
<li>Obtain <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> and <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> from <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, <span><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span>, <span><span class="MathJax_Preview">d</span><script type="math/tex">d</script></span></li>
</ul>
<h3 id="openssl">openssl<a class="headerlink" href="#openssl" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>View public key file</p>
<div class="highlight"><pre><span></span><code>openssl rsa -pubin -in pubkey.pem -text -modulus
</code></pre></div>

</li>
<li>
<p>Decryption</p>
<div class="highlight"><pre><span></span><code>rsautl -decrypt -inkey private.pem -in flag.enc -out flag
</code></pre></div>

</li>
</ul>
<p>For more specific details, please refer to <code>openssl --help</code>.</p>
<h3 id="decomposition-integer-tool">Decomposition Integer Tool<a class="headerlink" href="#decomposition-integer-tool" title="Permanent link">&para;</a></h3>
<ul>
<li>Website decomposition, <a href="http://factordb.com/">factor.db</a></li>
<li>Command line decomposition, <a href="https://github.com/ryosan-470/factordb-pycli">factordb-pycli</a>, borrowing the factordb database.</li>
<li><a href="https://sourceforge.net/projects/yafu/">yafu</a></li>
</ul>
<h3 id="python">python库<a class="headerlink" href="#python" title="Permanent link">&para;</a></h3>
<h4 id="primefac">primefac<a class="headerlink" href="#primefac" title="Permanent link">&para;</a></h4>
<p>The integer decomposition library contains many algorithms for integer decomposition.</p>
<h4 id="gmpy">gmpy<a class="headerlink" href="#gmpy" title="Permanent link">&para;</a></h4>
<ul>
<li><code>gmpy.root(a, b)</code>, returns a tuple <code>(x, y)</code>, where <code>x</code> is the value of <code>a</code> open <code>b</code> power, <code>y</code> is the judgment <code>x</code> whether Boolean variable that is an integer</li>
</ul>
<h4 id="gmpy2">gmpy2<a class="headerlink" href="#gmpy2" title="Permanent link">&para;</a></h4>
<p>When installing, you may need to install the mfpr and mpc libraries separately.</p>
<ul>
<li><code>gmpy2.iroot(a, b)</code>, similar to <code>gmpy.root(a,b)</code></li>
</ul>
<h4 id="pycrypto">pycrypto<a class="headerlink" href="#pycrypto" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Installation</p>
<div class="highlight"><pre><span></span><code>sudo pip install pycrypto
</code></pre></div>

</li>
<li>
<p>use</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gmpy</span>

<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>

<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">PKCS1_v1_5</span>



<span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;crypto here&#39;</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>

<span class="n">pubkey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">long</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>

<span class="n">privatekey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">long</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">q</span><span class="p">)))</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">pubkey</span><span class="p">)</span>

<span class="n">enc</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">)</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">privatekey</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">enc</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div>

</li>
</ul>
<h2 id="jarvis-oj-basic-veryeasyrsa">Jarvis OJ - Basic - veryeasyRSA<a class="headerlink" href="#jarvis-oj-basic-veryeasyrsa" title="Permanent link">&para;</a></h2>
<blockquote>
<p>p = 3487583947589437589237958723892346254777 q = 8767867843568934765983476584376578389</p>
<p>e = 65537</p>
<p>Find d =</p>
<p>Please submit <code>PCTF{d}</code></p>
</blockquote>
<p>Using <span><span class="MathJax_Preview">ed\equiv 1 \pmod{\varphi(N)}</span><script type="math/tex">ed\equiv 1 \pmod{\varphi(N)}</script></span>, we can obtain <span><span class="MathJax_Preview">d</span><script type="math/tex">d</script></span> from <span><span class="MathJax_Preview">\varphi (N)=\varphi (p)\varphi (q)=(p-1)(q-1)</span><script type="math/tex">\varphi (N)=\varphi (p)\varphi (q)=(p-1)(q-1)</script></span>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="n">p</span> <span class="o">=</span> <span class="mi">3487583947589437589237958723892346254777</span>

<span class="n">q</span> <span class="o">=</span> <span class="mi">8767867843568934765983476584376578389</span>

<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">phin</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phin</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>➜  Jarvis OJ-Basic-veryeasyRSA git:<span class="o">(</span>master<span class="o">)</span> ✗ python exp.py       

<span class="m">19178568796155560423675975774142829153827883709027717723363077606260717434369</span>
</code></pre></div>

<h2 id="2018-codegate-ctf-rsababy">2018 CodeGate CTF Rsababy<a class="headerlink" href="#2018-codegate-ctf-rsababy" title="Permanent link">&para;</a></h2>
<p>The program is a simple RSA, but the program also generates two strange numbers.</p>
<div class="highlight"><pre><span></span><code><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>

<span class="n">pi_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mulinv</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">pi_n</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="o">^</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">p</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mh">0xdeadbeef</span><span class="p">)</span>
</code></pre></div>

<p>So, the problem should come from here, so let's start with it, let's assume that <code>const = 0xdeadbeef</code>. Then</p>
<div>
<div class="MathJax_Preview">
eg = ed * (p-const)
</div>
<script type="math/tex; mode=display">
eg = ed * (p-const)
</script>
</div>
<p>Furthermore, according to RSA</p>
<div>
<div class="MathJax_Preview">
2^{eg}=2^{ed * (p-const)}=2^{p-const} \pmod n
</div>
<script type="math/tex; mode=display">
2^{eg}=2^{ed * (p-const)}=2^{p-const} \pmod n
</script>
</div>
<div>
<div class="MathJax_Preview">
2^{p-const} * 2^{const-1} = 2^{p-1} \pmod n
</div>
<script type="math/tex; mode=display">
2^{p-const} * 2^{const-1} = 2^{p-1} \pmod n
</script>
</div>
<p>So</p>
<div>
<div class="MathJax_Preview">
2^{p-1} = 2^{eg} * 2^{const-1}+kn
</div>
<script type="math/tex; mode=display">
2^{p-1} = 2^{eg} * 2^{const-1}+kn
</script>
</div>
<p>At the same time, according to Fermat's little theorem, we know</p>
<div>
<div class="MathJax_Preview">
2^{p-1} \equiv 1 \pmod p
</div>
<script type="math/tex; mode=display">
2^{p-1} \equiv 1 \pmod p
</script>
</div>
<p>So</p>
<div>
<div class="MathJax_Preview">
p|2^{p-1}-1 | 2^{eg+const-1}-1+kn
</div>
<script type="math/tex; mode=display">
p|2^{p-1}-1 | 2^{eg+const-1}-1+kn
</script>
</div>
<div>
<div class="MathJax_Preview">
p|2^{eg+const-1}-1
</div>
<script type="math/tex; mode=display">
p|2^{eg+const-1}-1
</script>
</div>
<div>
<div class="MathJax_Preview">
p|gcd(2^{eg+const-1}-1,n)
</div>
<script type="math/tex; mode=display">
p|gcd(2^{eg+const-1}-1,n)
</script>
</div>
<p>Hence the code is as follows</p>
<div class="highlight"><pre><span></span><code><span class="n">tmp</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">e</span><span class="o">*</span><span class="n">g</span><span class="o">+</span><span class="n">const</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="n">p</span>

<span class="n">Phin</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phin</span><span class="p">)</span>
<span class="n">plain</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

<span class="nb">print</span> <span class="nb">hex</span><span class="p">(</span><span class="n">plain</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
</code></pre></div>

<h2 id="2018-national-security-week-pure-math">2018 National Security Week pure math<a class="headerlink" href="#2018-national-security-week-pure-math" title="Permanent link">&para;</a></h2>
<p>The basic description of the topic is like this</p>
<div class="highlight"><pre><span></span><code>1) p ** p % q = 1137973316343089029387365135250835133803975869258714714790597743585251681751361684698632609164883988455302237641489036138661596754239799122081528662395492

2) q ** q % p = 6901383184477756324584651464895743132603115552606852729050186289748558760692261058141015199261946483809004373728135568483701274908717004197776113227815323

3) (p ** q + q ** p) % (p*q) = 16791287391494893024031688699360885996180880807427715700800644759680986120242383930558410147341340225420991368114858791447699399702390358184412301644459406

4) (p+q) ** (p+q) % (p*q) = 63112211860889153729003401381621068190906433969243079543438386686621389392583849748240273643614258173423474299387234175508649197780206757067354426424570586101908571600743792328163163458500138799976944702155779196849585083397395750018148652864158388247163109077215394538930498877175474225571393901460434679279

5) FLAG ** 31337 % (p*q) = 6931243291746179589612148118911670244427928875888377273917973305632621316868302667641610838193899081089153471883271406133321321416064760200919958612671379845738048938060512995550639898688604592620908415248701721672948126507753670027043162669545932921683579001870526727737212722417683610956855529996310258030

Now, what’s the FLAG???
</code></pre></div>

<p>Our goal is basically to find FLAG, but how can we find it? This question requires us to be more familiar with number theory.</p>
<p>From the content of the question, we can assume that <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>, <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> are both large prime numbers, so</p>
<p><span><span class="MathJax_Preview">p^{q-1} \equiv  1\bmod q</span><script type="math/tex">p^{q-1} \equiv  1\bmod q</script></span></p>
<p>Then</p>
<p><span><span class="MathJax_Preview">p^{q} \equiv p \bmod pq</span><script type="math/tex">p^{q} \equiv p \bmod pq</script></span></p>
<p>From 3), we know that</p>
<p><span><span class="MathJax_Preview">p^q+q^p \equiv p+q \bmod pq</span><script type="math/tex">p^q+q^p \equiv p+q \bmod pq</script></span></p>
<p>And <span><span class="MathJax_Preview">p+q</span><script type="math/tex">p+q</script></span> is obviously smaller than <span><span class="MathJax_Preview">pq</span><script type="math/tex">pq</script></span>, so we know the value of <span><span class="MathJax_Preview">p+q</span><script type="math/tex">p+q</script></span>.</p>
<p>We let <span><span class="MathJax_Preview">x_1</span><script type="math/tex">x_1</script></span>, <span><span class="MathJax_Preview">x_2</span><script type="math/tex">x_2</script></span>, <span><span class="MathJax_Preview">x_3</span><script type="math/tex">x_3</script></span>, <span><span class="MathJax_Preview">x_4</span><script type="math/tex">x_4</script></span>, <span><span class="MathJax_Preview">x_5</span><script type="math/tex">x_5</script></span> take the values of 1) to 5) respectively.</p>
<p>From 4), we have</p>
<p><span><span class="MathJax_Preview">(p+q)^{p+q} \equiv p^{p+q}+q^{p+q} \bmod pq</span><script type="math/tex">(p+q)^{p+q} \equiv p^{p+q}+q^{p+q} \bmod pq</script></span></p>
<p>And because of 1) and 2), then</p>
<p><span><span class="MathJax_Preview">p^pp \equiv px_1\bmod pq</span><script type="math/tex">p^pp \equiv px_1\bmod pq</script></span></p>
<p><span><span class="MathJax_Preview">q^qq \equiv qx_2 \bmod pq</span><script type="math/tex">q^qq \equiv qx_2 \bmod pq</script></span></p>
<p>therefore</p>
<p><span><span class="MathJax_Preview">px_1+qx_2 \equiv x_4 \bmod pq</span><script type="math/tex">px_1+qx_2 \equiv x_4 \bmod pq</script></span></p>
<p>From the way <span><span class="MathJax_Preview">x_1</span><script type="math/tex">x_1</script></span> and <span><span class="MathJax_Preview">x_2</span><script type="math/tex">x_2</script></span> are obtained, we know that <span><span class="MathJax_Preview">px_1+qx_2</span><script type="math/tex">px_1+qx_2</script></span> is also equal to <span><span class="MathJax_Preview">x_4</span><script type="math/tex">x_4</script></span>, so we get a system of linear equations in two variables and can solve it directly.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="n">x1</span> <span class="o">=</span> <span class="mi">1137973316343089029387365135250835133803975869258714714790597743585251681751361684698632609164883988455302237641489036138661596754239799122081528662395492</span>

<span class="n">X2</span> <span class="o">=</span> <span class="mi">6901383184477756324584651464895743132603115552606852729050186289748558760692261058141015199261946483809004373728135568483701274908717004197776113227815323</span>
<span class="n">p_q</span> <span class="o">=</span> <span class="mi">16791287391494893024031688699360885996180880807427715700800644759680986120242383930558410147341340225420991368114858791447699399702390358184412301644459406</span>

<span class="n">x4</span> <span class="o">=</span> <span class="mi">63112211860889153729</span> <span class="mi">0034062380936348635813582583974823274634293429254290729072907052006074920060749</span><span class="n">s729Readingly</span> <span class="mi">97297499258793650</span><span class="n">s</span> <span class="mi">8392407</span> <span class="mi">3105245</span> <span class="mi">94071857</span> <span class="mi">531058007</span> <span class="mi">518</span> <span class="mi">764</span> <span class="mi">579</span> <span class="mi">54</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>


<span class="k">if</span> <span class="p">(</span><span class="n">x4</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">p_q</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

    <span class="nb">print</span> <span class="s1">&#39;True&#39;</span>

<span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">x4</span> <span class="o">-</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">p_q</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">q</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">p_q</span> <span class="o">-</span> <span class="n">q</span>



<span class="n">c</span> <span class="o">=</span> <span class="mi">6931243291746179589612148118911670244427928875888377273917973305632621316868302667641610838193899081089153471883271406133321321416064760200919958612671379845738048938060512995550639898688604592620908415248701721672948126507753670027043162669545932921683579001870526727737212722417683610956855529996310258030</span>



<span class="n">Phin</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span> <span class="p">(</span><span class="mi">31337</span><span class="p">,</span> <span class="n">phin</span><span class="p">)</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span>

<span class="n">flag</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">flag</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>

<span class="nb">print</span> <span class="n">flag</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Flag is as follows</p>
<div class="highlight"><pre><span></span><code>➜ <span class="m">2018</span>-National Security Week first game-puremath git:<span class="o">(</span>master<span class="o">)</span> ✗ python exp.py
True

<span class="m">7635093784603905632817000902311635311970645531806863592697496927519352405158721310359124595712780726701027634372170535318453656286180828724079479352052417</span>

flag<span class="o">{</span>6a66b8d5-6047-4299-a48e-4c4d1f874d12<span class="o">}</span>
</code></pre></div>

<h2 id="2018-pwnhub-lhy">2018 Pwnhub LHY<a class="headerlink" href="#2018-pwnhub-lhy" title="Permanent link">&para;</a></h2>
<p>First analyze this code</p>
<div class="highlight"><pre><span></span><code><span class="k">assert</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">is_prime</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2016</span> <span class="o">+</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">is_prime</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2017</span> <span class="o">+</span> <span class="p">(</span>

    <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>

<span class="p">)</span><span class="o">**</span><span class="mi">2018</span> <span class="o">==</span> <span class="mi">30097557298197417800049182668952226601954645169633891463401117760245367082644152355564014438095421962150109895432272944128252155287648477680131934943095113263121691874508742328500559321036238322775864636883202538152031804102118831278605474474352011895348919417742923873371980983336517409056008233804190890418285814476821890492630167665485823056526646050928460488168341721716361299816947722947465808004305806687049198633489997459201469227952552870291934919760829984421958853221330987033580524592596407485826446284220272614663464267135596497185086055090126893989371261962903295313304735911034185619611156742146</span>
</code></pre></div>

<p>Since <code>gmpy.is_prime</code> either returns 1 or returns 0, we can easily try out that <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> is a prime number, <span><span class="MathJax_Preview">x+1</span><script type="math/tex">x+1</script></span> is also a prime number, and</p>
<p><span><span class="MathJax_Preview">(x^2-1)^2 \equiv 0 \bmod(2xy-1)</span><script type="math/tex">(x^2-1)^2 \equiv 0 \bmod(2xy-1)</script></span></p>
<p>In order for the expression to be divisible, we guess that <span><span class="MathJax_Preview">x=2y</span><script type="math/tex">x=2y</script></span>.</p>
<p>So for the following code</p>
<div class="highlight"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="mh">0x10001</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<span class="n">enc</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">),</span> <span class="mh">0x10001</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;n =&#39;</span><span class="p">,</span> <span class="n">n</span>
<span class="nb">print</span> <span class="s1">&#39;enc =&#39;</span><span class="p">,</span> <span class="n">enc</span>
</code></pre></div>

<p><span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> and <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> are naturally</p>
<p><span><span class="MathJax_Preview">p=next\_prime(9y^3)</span><script type="math/tex">p=next\_prime(9y^3)</script></span></p>
<p><span><span class="MathJax_Preview">q=next\_prime(6y^3)</span><script type="math/tex">q=next\_prime(6y^3)</script></span></p>
<p>According to the interval of prime numbers, we know that <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> and <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> are at most a little larger than the numbers in parentheses, and generally would not exceed <span><span class="MathJax_Preview">1000</span><script type="math/tex">1000</script></span> here.</p>
<p>Then</p>
<p><span><span class="MathJax_Preview">n \geq 54y^6</span><script type="math/tex">n \geq 54y^6</script></span></p>
<p>So we know the upper bound of <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span>, and the lower bound of <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> is actually not too far from the upper bound, we probably reduce hundreds of thousands. Hence, we use binary search to find <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> and <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span>, as follows</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="mi">30097557298197417800049182668952226601954645169633891463401117760245367082644152355564014438095421962150109895432272944128252155287648477680131934943095113263121691874508742328500559321036238322775864636883202538152031804102118831278605474474352011895348919417742923873371980983336517409056008233804190890418285814476821890492630167665485823056526646050928460488168341721716361299816947722947465808004305806687049198633489997459201469227952552870291934919760829984421958853221330987033580524592596407485826446284220272614663464267135596497185086055090126893989371261962903295313304735911034185619611156742146</span>

<span class="nb">print</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">2018</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">tmp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2018</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">tmp</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2018</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">260272753019642842691231717156206014402348296256668058656902033827190888150939144319270903947159599144884859205368557385941127216969379550487700198771513118894125094678559478972591331182960004648132846372455712958337042783083099376871113795475285658106058675217077803768944674144803250791799957440111855021945690877200606577646234107957498370758707097662736662439460472126493593605957225541979181422479704018055731221681621886820626215670393536343427267329350730257979042198593215747542270975288047196483958369426727778580292311145109908665004662296440533724591193527886702374790526322791818523938910660223971454070731594803459613066617828657725704376475527288174777197739360634209448477565044519733575375490101670974499385760735451471034271880800081246883157088501597655371430353965493264345172541221268942926210055390568364981514774743693528424196241142665685211916330254113610598390909248626686397970038848966187547231199741</span>

<span class="n">y</span> <span class="o">=</span> <span class="mi">191904757378974300059526915134037747982760255307942501070454569331878491189601823952845623286161325306079772871025816081849039036850918375408172174102720702781463514549851887084613000000</span><span class="n">L</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">enc</span> <span class="o">=</span> <span class="mi">73933313646416156737449236838459526871566017180178176765840447023088664788672323530940171469589918772272559607026808711216932468486201094786991159096267208480969757088208089800600731106685561375522764783335332964711981392251568543122418192877756299395774738176188452197889668610818741062203831272066261677731889616150485770623945568369493256759711422067551058418926344060504112146971937651406886327429318390247733970549845424064244469193626197360072341969574784310397213033860597822010667926563087858301337091484951760613299203587677078666096526093414014637559237148644939541419075479462431789925219269815364529507771308181435591670281081465439913711912925412078002618729159141400730636976744132429329651487292506365655834202469178066850282850374067239317928012461993443785247524500680257923687511378073703423047348824611101206633407452837948194591695712958510124436821151767823443033286425729473563002691262316964646014201612</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">6</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">beg</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="mi">2000000</span>

<span class="n">mid</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">beg</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">beg</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">is_prime</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">mid</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">mid</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
    <span class="k">if</span> <span class="n">n1</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span>
        <span class="n">phin</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="mh">0x10001</span><span class="p">,</span> <span class="n">phin</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="nb">print</span> <span class="nb">hex</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;ok&#39;</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n1</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">beg</span> <span class="o">=</span> <span class="n">mid</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">mid</span>
    <span class="nb">print</span> <span class="n">beg</span><span class="p">,</span> <span class="n">end</span>
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../../js/base.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
        <script src="../../../../../_static/js/extra.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.crypto/ctf-wiki/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
