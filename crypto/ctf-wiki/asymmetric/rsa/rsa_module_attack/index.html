<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../img/favicon.ico">
        <title>模数相关攻击 - 西山下,闻溪语,书心境</title>
        <link href="../../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../../..">西山下,闻溪语,书心境</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Index <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../.." class="dropdown-item">首页</a>
</li>
                                    
<li>
    <a href="../../../../../about/" class="dropdown-item">关于我</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Crypto <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">ctf-wiki中的资料</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../introduction/" class="dropdown-item">密码学简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">基础数学知识</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../basic/introduction/" class="dropdown-item">简介</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">古典密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../classical/introduction/" class="dropdown-item">古典密码简介</a>
</li>
            
<li>
    <a href="../../../classical/monoalphabetic/" class="dropdown-item">单表代换加密</a>
</li>
            
<li>
    <a href="../../../classical/polyalphabetic/" class="dropdown-item">多表代换加密</a>
</li>
            
<li>
    <a href="../../../classical/others/" class="dropdown-item">其他类型加密</a>
</li>
            
<li>
    <a href="../../../classical/summary/" class="dropdown-item">总结</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/intro/" class="dropdown-item">介绍</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">伪随机数生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/prng/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../streamcipher/prng/csprng/" class="dropdown-item">密码学安全伪随机数生成器</a>
</li>
            
<li>
    <a href="../../../streamcipher/prng/problem/" class="dropdown-item">题目</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">线性同余生成器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/lcg/intro/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../../streamcipher/lcg/challenge/" class="dropdown-item">例题</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">反馈移位寄存器</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/fsr/intro/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../streamcipher/fsr/lfsr/" class="dropdown-item">线性反馈移位寄存器</a>
</li>
            
<li>
    <a href="../../../streamcipher/fsr/nfsr/" class="dropdown-item">非线性反馈移位寄存器</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">特殊流密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../streamcipher/special/rc4/" class="dropdown-item">RC4</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">块加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../blockcipher/introduction/" class="dropdown-item">块加密简介</a>
</li>
            
<li>
    <a href="../../../blockcipher/arx-operations/" class="dropdown-item">ARX</a>
</li>
            
<li>
    <a href="../../../blockcipher/des/" class="dropdown-item">DES</a>
</li>
            
<li>
    <a href="../../../blockcipher/idea/" class="dropdown-item">IDEA</a>
</li>
            
<li>
    <a href="../../../blockcipher/aes.md" class="dropdown-item">AES</a>
</li>
            
<li>
    <a href="../../../blockcipher/simon-speck/" class="dropdown-item">Simon and Speck</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">分组模式</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../blockcipher/mode/introduction/" class="dropdown-item">介绍</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/padding/" class="dropdown-item">填充方式</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ecb/" class="dropdown-item">ECB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/cbc/" class="dropdown-item">CBC</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/pcbc/" class="dropdown-item">PCBC</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/cfb/" class="dropdown-item">CFB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ofb/" class="dropdown-item">OFB</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/ctr/" class="dropdown-item">CTR</a>
</li>
            
<li>
    <a href="../../../blockcipher/mode/padding-oracle-attack/" class="dropdown-item">Padding Oracle Attack</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">非对称加密</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../introduction/" class="dropdown-item">非对称加密简介</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">RSA</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../rsa_theory/" class="dropdown-item">RSA 基本介绍</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">模数相关攻击</a>
</li>
            
<li>
    <a href="../rsa_e_attack/" class="dropdown-item">公钥指数相关攻击</a>
</li>
            
<li>
    <a href="../rsa_d_attack/" class="dropdown-item">私钥 d 相关攻击</a>
</li>
            
<li>
    <a href="../rsa_coppersmith_attack.md" class="dropdown-item">Coppersmith 相关攻击</a>
</li>
            
<li>
    <a href="../rsa_chosen_plain_cipher/" class="dropdown-item">选择明密文攻击</a>
</li>
            
<li>
    <a href="../rsa_side_channel/" class="dropdown-item">侧信道攻击</a>
</li>
            
<li>
    <a href="../rsa_pkcs_attack/" class="dropdown-item">Bleichenbacher 攻击</a>
</li>
            
<li>
    <a href="../rsa_complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../knapsack/knapsack/" class="dropdown-item">背包加密</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">离散对数相关</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../discrete-log/discrete-log/" class="dropdown-item">离散对数</a>
</li>
            
<li>
    <a href="../../discrete-log/elgamal/" class="dropdown-item">Elgamal</a>
</li>
            
<li>
    <a href="../../discrete-log/ecc/" class="dropdown-item">ECC</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">格密码</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../lattice/overview/" class="dropdown-item">格概述</a>
</li>
            
<li>
    <a href="../../lattice/introduction/" class="dropdown-item">格介绍</a>
</li>
            
<li>
    <a href="../../lattice/lattice-reduction/" class="dropdown-item">格基规约算法</a>
</li>
            
<li>
    <a href="../../lattice/cvp/" class="dropdown-item">CVP</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">哈希函数</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../hash/introduction/" class="dropdown-item">哈希函数简介</a>
</li>
            
<li>
    <a href="../../../hash/md5/" class="dropdown-item">MD5</a>
</li>
            
<li>
    <a href="../../../hash/sha1/" class="dropdown-item">SHA1</a>
</li>
            
<li>
    <a href="../../../hash/fnv/" class="dropdown-item">FNV</a>
</li>
            
<li>
    <a href="../../../hash/attack/" class="dropdown-item">Hash Attack</a>
</li>
            
<li>
    <a href="../../../hash/complex/" class="dropdown-item">综合</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">数字签名</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../signature/introduction/" class="dropdown-item">数字签名简介</a>
</li>
            
<li>
    <a href="../../../signature/rsa/" class="dropdown-item">RSA 数字签名</a>
</li>
            
<li>
    <a href="../../../signature/elgamal.md" class="dropdown-item">ElGamal 数字签名</a>
</li>
            
<li>
    <a href="../../../signature/dsa/" class="dropdown-item">DSA 数字签名</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">攻击思想总结</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../attack-summary/attack-mode/" class="dropdown-item">简介</a>
</li>
            
<li>
    <a href="../../../attack-summary/meet-in-the-middle/" class="dropdown-item">中间相遇攻击</a>
</li>
            
<li>
    <a href="../../../attack-summary/bit-attack/" class="dropdown-item">比特攻击</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../rsa_theory/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../rsa_e_attack/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#violence-breakdown-n" class="nav-link">Violence breakdown N</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#p-q-improper-decomposition-n" class="nav-link">p &amp; q Improper decomposition N</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#_1" class="nav-link">模不素素</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#common-mode-attack" class="nav-link">Common mode attack</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#topic" class="nav-link">topic</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="./">EN</a> | <a href="../rsa_module_attack-zh/">ZH</a></p>
<h2 id="violence-breakdown-n">Violence breakdown N<a class="headerlink" href="#violence-breakdown-n" title="Permanent link">&para;</a></h2>
<h3 id="attack-conditions">Attack conditions<a class="headerlink" href="#attack-conditions" title="Permanent link">&para;</a></h3>
<p>When the number of bits in N is less than 512, p and q can be obtained using a strategy of large integer decomposition.</p>
<h3 id="jarvisoj-medium-rsa">JarvisOJ - Medium RSA<a class="headerlink" href="#jarvisoj-medium-rsa" title="Permanent link">&para;</a></h3>
<p>Here we take JarvisOJ - Medium RSA as an example, the topic is as follows</p>
<p>&gt; Remember the veryeasy RSA? Is it not difficult? Then continue to look at this question, this question is not difficult.
&gt; Known piece of RSA encrypted information is: 0xdc2eeeb2782c and the public key used for encryption is known:
&gt; N = 322831561921859 and = 23
&gt; Please decrypt the plaintext, please convert the number into ascii code submission when submitting
&gt; For example, if the plaintext you solved is 0x6162, please submit the string ab
&gt; Submit format: <code>PCTF{clear text string}</code></p>
<p>It can be seen that our N is relatively small, here we directly use factordb to decompose, you can get</p>
<p>$$</p>
<p>322831561921859 = 13574881 \times 23781539</p>
<p>$$</p>
<p>Then we simply write the program as follows</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="n">p</span> <span class="o">=</span> <span class="mi">13574881</span>

<span class="n">q</span> <span class="o">=</span> <span class="mi">23781539</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>

<span class="n">e</span> <span class="o">=</span> <span class="mi">23</span>
<span class="n">c</span> <span class="o">=</span> <span class="mh">0xdc2eeeb2782c</span>

<span class="n">Phin</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phin</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="n">tmp</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Results are as follows</p>
<div class="highlight"><pre><span></span><code>➜  Jarvis OJ-Basic-easyRSA git:<span class="o">(</span>master<span class="o">)</span> ✗ python exp.py

0x3613559 3a5Y
</code></pre></div>

<h2 id="p-q-improper-decomposition-n">p &amp; q Improper decomposition N<a class="headerlink" href="#p-q-improper-decomposition-n" title="Permanent link">&para;</a></h2>
<h3 id="attack-conditions_1">Attack conditions<a class="headerlink" href="#attack-conditions_1" title="Permanent link">&para;</a></h3>
<p>We can also attack when p and q are not selected properly in RSA.</p>
<h3 id="pq-very-large">|pq| Very large<a class="headerlink" href="#pq-very-large" title="Permanent link">&para;</a></h3>
<p>When pq is large, there must be a certain parameter is small, here we assume p, then we can try to divide the modulus by exhaustive method, and then decompose the modulus, get the confidential parameters and plaintext information. Basically, it is not very feasible.</p>
<h3 id="pq-smaller">|pq| Smaller<a class="headerlink" href="#pq-smaller" title="Permanent link">&para;</a></h3>
<p>First of all</p>
<p>$$</p>
<p>\frac{(p+q)<sup>2}{4}-n=\frac{(p+q)</sup>2}{4}-pq=\frac{(p-q)^2}{4}</p>
<p>$$</p>
<p>Since |pq| is small, <span><span class="MathJax_Preview">\frac{(pq)^2}{4}</span><script type="math/tex">\frac{(pq)^2}{4}</script></span> is naturally small, and <span><span class="MathJax_Preview">\frac{(p+q)^2}{4}</span><script type="math/tex">\frac{(p+q)^2}{4}</script></span> is only slightly larger than N. , so <span><span class="MathJax_Preview">\frac{p+q}{2}</span><script type="math/tex">\frac{p+q}{2}</script></span> is similar to <span><span class="MathJax_Preview">\sqrt{n}</span><script type="math/tex">\sqrt{n}</script></span>. Then we can decompose as follows</p>
<ul>
<li>Check each integer x of <span><span class="MathJax_Preview">\sqrt{n}</span><script type="math/tex">\sqrt{n}</script></span> in sequence until you find an x such that <span><span class="MathJax_Preview">x^2-n</span><script type="math/tex">x^2-n</script></span> is the square number, denoted as <span><span class="MathJax_Preview">y^2</span><script type="math/tex">y^2</script></span></li>
<li>Then <span><span class="MathJax_Preview">x^2-n=y^2</span><script type="math/tex">x^2-n=y^2</script></span>, and then decompose N according to the squared difference formula</li>
</ul>
<h3 id="p-1-smooth">p - 1 Smooth<a class="headerlink" href="#p-1-smooth" title="Permanent link">&para;</a></h3>
<p>When p is a factor of N and p - 1 is smooth, it is possible to use the Pollard&#39;s p − 1 algorithm to decompose N, but it is not entirely successful.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
</div>
<p>Principle analysis to be completed</p>
<h3 id="p-1-smooth_1">p + 1 Smooth<a class="headerlink" href="#p-1-smooth_1" title="Permanent link">&para;</a></h3>
<p>When p is a factor of n and p + 1 is smooth, it may be possible to use the Williams&#39;s p + 1 algorithm to decompose N, but it is not entirely successful.</p>
<h3 id="2017-seccon-very-smooth">2017 SECCON very smooth<a class="headerlink" href="#2017-seccon-very-smooth" title="Permanent link">&para;</a></h3>
<p>The program gives an HTTPS encrypted traffic packet, first getting the certificate from it.</p>
<div class="highlight"><pre><span></span><code>➜  2017_SECCON_verysmooth git:<span class="o">(</span>master<span class="o">)</span> binwalk -e s.pcap      



DECIMAL       HEXADECIMAL     DESCRIPTION

--------------------------------------------------------------------------------

<span class="m">2292</span>          0x8F4           Certificate in DER format <span class="o">(</span>x509 v3<span class="o">)</span>, header length: <span class="m">4</span>, sequence length: <span class="m">467</span>

<span class="m">4038</span>          0xFC6           Certificate in DER format <span class="o">(</span>x509 v3<span class="o">)</span>, header length: <span class="m">4</span>, sequence length: <span class="m">467</span>

<span class="m">5541</span>          0x15A5          Certificate in DER format <span class="o">(</span>x509 v3<span class="o">)</span>, header length: <span class="m">4</span>, sequence length: <span class="m">467</span>



➜ 2017_SECCON_verysmooth git: <span class="o">(</span>master<span class="o">)</span> ls
s.pcap  _s.pcap.extracted  very_smooth.zip
</code></pre></div>

<p>Here are three certificates, three modules are the same, only one example is given here.</p>
<div class="highlight"><pre><span></span><code>➜  _s.pcap.extracted git:(master) openssl x509 -inform DER -in FC6.crt  -pubkey -text -modulus -noout 

-----BEGIN PUBLIC KEY-----

MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDVRqqCXPYd6Xdl9GT7/kiJrYvy

8lohddAsi28qwMXCe2cDWuwZKzdB3R9NEnUxsHqwEuuGJBwJwIFJnmnvWurHjcYj
DUddp + 4X8C9jtvCaLTgd + baSjo2eB0f + uiSL / 9 / 4NN + vR3FliRm2mByeFCjppTQl
yioxCqbXYIMxGO4NcQIDAQAB
-----END PUBLIC KEY-----

Certificate:

    Data:

        Version: 1 (0x0)

        Serial Number: 11640506567126718943 (0xa18b630c7b3099df)

    Signature Algorithm: sha256WithRSAEncryption

        Issuer: C=JP, ST=Kawasaki, O=SRL

        Validity

            Not Before: Oct  8 02:47:17 2017 GMT

            Not After : Oct  8 02:47:17 2018 GMT

        Subject: C=JP, ST=Kawasaki, O=SRL

        Subject Public Key Info:

            Public Key Algorithm: rsaEncryption

                Public-Key: (1024 bit)

                Modulus:

                    00:d5:46:aa:82:5c:f6:1d:e9:77:65:f4:64:fb:fe:

                    48:89:ad:8b:f2:f2:5a:21:75:d0:2c:8b:6f:2a:c0:

c5: c2: 7b: 67: 03: 5a: ec: 19: 2b: 37: 41: dd: 1f: 4d: 12:
75: 31: b0: 7a: b0: 12: eb: 86: 24: 1c: 09: c0: 81: 49: 9e:
69: ef: 5a: ea: c7: 8d: c6: 23: 0d: 47: 5d: a7: ee: 17: f0:
2f: 63: b6: f0: 9a: 2d: 38: 1d: f9: b6: 92: 8e: 8d: 9e:47: fe: ba: 24: 8b: ff: df: f8: 9c: df: af: 47: 71: 65: 89:
19: b6: 98: 1: 9e: 14: 28: e9: a5: 34: 25: ca: 2a: 31: 0a:
a6: d7: 60: 83: 31: 18: in: 0d: 71
                Exponent: 65537 (0x10001)

    Signature Algorithm: sha256WithRSAEncryption

78: 92: 11: fb: 6c: e1: 7a: f7: 2a: 33: b8: 8b: 08: a7: f7: 5b: de: cf:
         62:0b:a0:ed:be:d0:69:88:38:93:94:9d:05:41:73:bd:7e:b3:

         32:ec:8e:10:bc:3a:62:b0:56:c7:c1:3f:60:66:a7:be:b9:46:

         f7:46:22:6a:f3:5a:25:d5:66:94:57:0e:fc:b5:16:33:05:1c:

         6f:f5:85:74:57:a4:a0:c6:ce:4f:fd:64:53:94:a9:83:b8:96:

bf: 5b: a7: ee: 8b: 1e: 48: a7: d2: 43: 06: 0e: 4f: 5a: 86: 62: 69:
e2: c0: bd: 4e: 89: c9: af: 04: 4a: 77: a2:
b7: 39
Modulus=D546AA825CF61DE97765F464FBFE4889AD8BF2F25A2175D02C8B6F2AC0C5C27B67035AEC192B3741DD1F4D127531B07AB012EB86241C09C081499E69EF5AEAC78DC6230D475DA7EE17F02F63B6F09A2D381DF9B6928E8D9E0747FEBA248BFFDFF89CDFAF4771658919B6981C9E1428E9A53425CA2A310AA6D760833118EE0D71
</code></pre></div>

<p>It can be seen that the modulus is only 1024 bits. Moreover, according to the title name very smooth, it should be one of the factors comparing smooth, here we use the primaryfac to try Pollard&#39;s p − 1 and Williams&#39;s p + 1 algorithm respectively, as follows</p>
<div class="highlight"><pre><span></span><code>➜  _s.pcap.extracted git:<span class="o">(</span>master<span class="o">)</span> python -m primefac -vs -m<span class="o">=</span>p+1  <span class="m">149767527975084886970446073530848114556615616489502613024958495602726912268566044330103850191720149622479290535294679429142532379851252608925587476670908668848275349192719279981470382501117310509432417895412013324758865071052169170753552224766744798369054498758364258656141800253652826603727552918575175830897</span>



<span class="m">149767527975084886970446073530848114556615616489502613024958495602726912268566044330103850191720149622479290535294679429142532379851252608925587476670908668848275349192719279981470382501117310509432417895412013324758865071052169170753552224766744798369054498758364258656141800253652826603727552918575175830897</span>: p+1 <span class="m">11807485231629132025602991324007150366908229752508016230400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001</span> <span class="m">12684117323636134264468162714319298445454220244413621344524758865071052169170753552224766744798369054498758364258656141800253652826603727552918575175830897</span>

<span class="nv">Z309</span>  <span class="o">=</span>  P155 x <span class="nv">P155</span>  <span class="o">=</span>  <span class="m">11807485231629132025602991324007150366908229752508016230400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001</span> x <span class="m">12684117323636134264468162714319298445454220244413621344524758865071052169170753552224766744798369054498758364258656141800253652826603727552918575175830897</span>
</code></pre></div>

<p>It can be found that when using the Williams&#39;s <em>p</em> + 1 algorithm, it is directly decomposed. It is reasonable to say that this factor is p-1 seems to be smoother, but it cannot be decomposed using the Pollard&#39;s p − 1 algorithm. Further testing is done here.</p>
<div class="highlight"><pre><span></span><code>➜  _s.pcap.extracted git:<span class="o">(</span>master<span class="o">)</span> python -m primefac -vs <span class="m">1180748523162913202560299132400715036690822975250801623040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002</span>



<span class="m">1180748523162913202560299132400715036690822975250801623040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002</span>: <span class="m">2</span> <span class="m">7</span> <span class="m">43</span> <span class="m">503</span> <span class="m">761429</span> <span class="m">5121103123294685745276806480148867612214394022184063853387799606010231770631857868979139305712805242051823263337587909550709296150544706624823</span>

<span class="nv">Z154</span>  <span class="o">=</span>  P1 x P1 x P2 x P3 x P6 x <span class="nv">P142</span>  <span class="o">=</span>  <span class="m">2</span> x <span class="m">7</span> x <span class="m">43</span> x <span class="m">503</span> x <span class="m">761429</span> x <span class="m">5121103123294685745276806480148867612214394022184063853387799606010231770631857868979139305712805242051823263337587909550709296150544706624823</span>



➜  _s.pcap.extracted git:<span class="o">(</span>master<span class="o">)</span> python -m primefac -vs <span class="m">1180748523162913202560299132400715036690822975250801623040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span> 



<span class="m">1180748523162913202560299132400715036690822975250801623040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span>: <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">3</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span> <span class="m">5</span>

<span class="nv">Z154</span>  <span class="o">=</span>  P1^185 x P1^62 x P1^97  <span class="o">=</span>  <span class="m">2</span>^185 x <span class="m">3</span>^62 x <span class="m">5</span>^97
</code></pre></div>

<p>It can be seen that there are indeed many small factors for p-1, but the number is too large, which will cause an exponential explosion when enumerating, so it is not decomposed.</p>
<p>And construct a private key based on the decomposed number</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>

<span class="kn">import</span> <span class="nn">gmpy2</span>





<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">149767527975084886970446073530848114556615616489502613024958495602726912268566044330103850191720149622479290535294679429142532379851252608925587476670908668848275349192719279981470382501117310509432417895412013324758865071052169170753552224766744798369054498758364258656141800253652826603727552918575175830897</span><span class="n">L</span>

    <span class="n">p</span> <span class="o">=</span> <span class="mi">11807485231629132025602991324007150366908229752508016230400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001</span><span class="n">L</span>

    <span class="n">q</span> <span class="o">=</span> <span class="mi">12684117323636134264468162714319298445454220244413621344524758865071052169170753552224766744798369054498758364258656141800253652826603727552918575175830897</span><span class="n">L</span>

<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span><span class="n">L</span>
    <span class="n">priv</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">long</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))))</span>

    <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;private.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">priv</span><span class="o">.</span><span class="n">exportKey</span><span class="p">(</span><span class="s1">&#39;PEM&#39;</span><span class="p">))</span>





<span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>Finally, import the private key into wireshark to get the plain text (Edit -&gt; Preferences -&gt; Protocols -&gt; SSL -&gt; RSA Key List).</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Very smooth<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>

Answer: One of these primes is very smooth.

<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<h3 id="extension">Extension<a class="headerlink" href="#extension" title="Permanent link">&para;</a></h3>
<p>For more on some methods of decomposing the modulus N, please refer to <a href="https://en.wikipedia.org/wiki/Integer_factorization">https://en.wikipedia.org/wiki/Integer_factorization</a>.</p>
<h2 id="_1">模不素素<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="attack-principle">Attack principle<a class="headerlink" href="#attack-principle" title="Permanent link">&para;</a></h3>
<p>When there are two public keys, N is not mutually prime, we can obviously obtain the greatest common factor directly for these two numbers, and then directly obtain p, q, and then obtain the corresponding private key.</p>
<h3 id="sctf-rsa2">SCTF RSA2<a class="headerlink" href="#sctf-rsa2" title="Permanent link">&para;</a></h3>
<p>Here we take SCTF rsa2 as an example. Open the pcap package directly and find that there are a bunch of messages, including N and e, and then try to test whether the different N is mutual. I tried the first two.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="n">n1</span> <span class="o">=</span>
<span class="n">n2</span> <span class="o">=</span>
<span class="nb">print</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
</code></pre></div>

<p>The results found that they were not mutually exclusive.</p>
<div class="highlight"><pre><span></span><code>➜  scaf-rsa2 git:<span class="o">(</span>master<span class="o">)</span> ✗ python exp.py

<span class="m">122281872221091773923842091258531471948886120336284482555605167683829690073110898673260712865021244633908982705290201598907538975692920305239961645109897081011524485706755794882283892011824006117276162119331970728229108731696164377808170099285659797066904706924125871571157672409051718751812724929680249712137</span>
</code></pre></div>

<p>Then we can decrypt it directly, here we use the first pair of public key ciphers. code show as below</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>

<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">PKCS1_v1_5</span><span class="p">,</span> <span class="n">PKCS1_OAEP</span>

<span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>

<span class="n">n1</span> <span class="o">=</span>
<span class="n">n2</span> <span class="o">=</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>

<span class="n">q1</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">/</span> <span class="n">p1</span>

<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">phin</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phin</span><span class="p">)</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="mh">0x68d5702b70d18238f9d4a3ac355b2a8934328250efd4efda39a4d750d80818e6fe228ba3af471b27cc529a4b0bef70a2598b80dd251b15952e6a6849d366633ed7bb716ed63c6febd4cd0621b0c4ebfe5235de03d4ee016448de1afbbe61144845b580eed8be8127a8d92b37f9ef670b3cdd5af613c76f58ca1a9f6f03f1bc11addba30b61bb191efe0015e971b8f78375faa257a60b355050f6435d94b49eab07075f40cb20bb8723d02f5998d5538e8dafc80cc58643c91f6c0868a7a7bf3bf6a9b4b6e79e0a80e89d430f0c049e1db4883c50db066a709b89d74038c34764aac286c36907b392bc299ab8288f9d7e372868954a92cdbf634678f7294096c7</span>

<span class="n">plain</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">cipher</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>

<span class="n">plain</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">plain</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>

<span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">plain</span><span class="p">)</span><span class="o">%</span> <span class="mi">2</span><span class="err">!</span> <span class="o">=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">plain</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">plain</span>

<span class="nb">print</span> <span class="n">plain</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Finally decrypted as follows</p>
<div class="highlight"><pre><span></span><code>➜  scaf-rsa2 git:<span class="o">(</span>master<span class="o">)</span> ✗ python exp.py       
sH1R3_PRlME_1N_rsA_iS_4ulnEra5le
</code></pre></div>

<p>Unzip the package.</p>
<h2 id="common-mode-attack">Common mode attack<a class="headerlink" href="#common-mode-attack" title="Permanent link">&para;</a></h2>
<h3 id="attack-conditions_2">Attack conditions<a class="headerlink" href="#attack-conditions_2" title="Permanent link">&para;</a></h3>
<p>When two users use the same modulus N and different private keys, there is a common mode attack when encrypting the same plaintext message.</p>
<h3 id="attack-principle_1">Attack principle<a class="headerlink" href="#attack-principle_1" title="Permanent link">&para;</a></h3>
<p>Let the public keys of the two users be <span><span class="MathJax_Preview">e_1</span><script type="math/tex">e_1</script></span> and <span><span class="MathJax_Preview">e_2</span><script type="math/tex">e_2</script></span>, respectively, and they are mutually prime. The plain text message is <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> and the ciphertext is:</p>
<p>$$</p>
<p>c_1 = m ^ {} e_1  N \ way
c_2 = m ^ {} e_2  N way
$$</p>
<p>When the attacker intercepts <span><span class="MathJax_Preview">c_1</span><script type="math/tex">c_1</script></span> and <span><span class="MathJax_Preview">c_2</span><script type="math/tex">c_2</script></span>, the plaintext can be recovered. Use the extended Euclidean algorithm to find the two integers <span><span class="MathJax_Preview">r</span><script type="math/tex">r</script></span> and <span><span class="MathJax_Preview">s</span><script type="math/tex">s</script></span> of <span><span class="MathJax_Preview">re_1+se_2=1\bmod n</span><script type="math/tex">re_1+se_2=1\bmod n</script></span>, which gives you:</p>
<p>$$</p>
<p>\begin{align*}</p>
<p>c_{1}<sup>{r}c_{2}</sup>{s} &amp;\equiv m<sup>{re_1}m</sup>{se_2}\bmod n\</p>
<p>&amp;\equiv m^{(re_1+se_2)} \bmod n\</p>
<p>&amp;\equiv m\bmod n</p>
<p>\end{align*}</p>
<p>$$</p>
<h3 id="xman-phase-i-summer-camp-classroom-exercise">XMan Phase I Summer Camp Classroom Exercise<a class="headerlink" href="#xman-phase-i-summer-camp-classroom-exercise" title="Permanent link">&para;</a></h3>
<p>Description of the topic:</p>
<div class="highlight"><pre><span></span><code>{6266565720726907265997241358331585417095726146341989755538017122981360742813498401533594757088796536341941659691259323065631249,773}



{6266565720726907265997241358331585417095726146341989755538017122981360742813498401533594757088796536341941659691259323065631249,839}



message1 = 3453520592723443935451151545245025864232388871721682326408915024349804062041976702364728660682912396903968193981131553111537349


message2 = 5672818026816293344070119332536629619457163570036305296869053532293105379690793386019065754465292867769521736414170803238309535
</code></pre></div>

<p>&gt; Source: XMan Summer Camp Class Exercise</p>
<p>It can be seen that the N of the two public keys are the same, and the e of the two are mutually prime. Write a script to run:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">6266565720726907265997241358331585417095726146341989755538017122981360742813498401533594757088796536341941659691259323065631249</span>

<span class="n">e1</span> <span class="o">=</span> <span class="mi">773</span>


<span class="n">e2</span> <span class="o">=</span> <span class="mi">839</span>



<span class="n">message1</span> <span class="o">=</span> <span class="mi">3453520592723443935451151545245025864232388871721682326408915024349804062041976702364728660682912396903968193981131553111537349</span>


<span class="n">message2</span> <span class="o">=</span> <span class="mi">5672818026816293344070119332536629619457163570036305296869053532293105379690793386019065754465292867769521736414170803238309535</span>
<span class="c1"># s &amp; t</span>

<span class="n">gcd</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcdext</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>

<span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

    <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span>

    <span class="n">message1</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">message1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

    <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">t</span>

    <span class="n">message2</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">message2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="n">plain</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">message1</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">message2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>

<span class="nb">print</span> <span class="n">plain</span>
</code></pre></div>

<p>get</p>
<div class="highlight"><pre><span></span><code>➜  Xman-1-class-exercise git:<span class="o">(</span>master<span class="o">)</span> ✗ python exp.py

<span class="m">1021089710312311910410111011910111610410511010710511610511511211111511510598108101125</span>
</code></pre></div>

<p>At this time, you need to consider how the plaintext was converted to this number, which is generally a hexadecimal conversion, ASCII character conversion, or Base64 decryption. This should be an ASCII character conversion, and then we use the following code to get the flag</p>
<div class="highlight"><pre><span></span><code><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="n">plain</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plain</span><span class="p">)</span>

<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">plain</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">plain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>

        <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">plain</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]))</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="mi">3</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">plain</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>

        <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>

<span class="nb">print</span> <span class="n">flag</span>
</code></pre></div>

<p>The reason why 1 is used to determine whether it is three-bit length is because the flag is usually a plain text character, and the number starting with 1 is 1 or 2, which is generally an invisible character.</p>
<p>flag</p>
<div class="highlight"><pre><span></span><code>➜  Xman-1-class-exercise git:<span class="o">(</span>master<span class="o">)</span> ✗ python exp.py

flag<span class="o">{</span>whenwethinkitispossible<span class="o">}</span>
</code></pre></div>

<h2 id="topic">topic<a class="headerlink" href="#topic" title="Permanent link">&para;</a></h2>
<ul>
<li>Jarvis OJ very hard RSA</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../../js/base.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
        <script src="../../../../../_static/js/extra.js" defer></script>
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.crypto/ctf-wiki/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
