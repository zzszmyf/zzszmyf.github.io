<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../../../img/favicon.ico">
  <title>选择明密文攻击 - 西山下,闻溪语,书心境</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../../../css/theme.css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u9009\u62e9\u660e\u5bc6\u6587\u653b\u51fb";
    var mkdocs_page_input_path = "crypto/asymmetric/rsa/rsa_chosen_plain_cipher.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> 西山下,闻溪语,书心境</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">Index</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../..">首页</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../../../about/">关于我</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Crypto</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../../../introduction/">密码学简介</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">基础数学知识</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../basic/introduction/">简介</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">古典密码</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../classical/introduction/">古典密码简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../classical/monoalphabetic/">单表代换加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../classical/polyalphabetic/">多表代换加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../classical/others/">其他类型加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../classical/summary/">总结</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">流密码</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../streamcipher/intro/">介绍</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">伪随机数生成器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/prng/intro/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/prng/csprng/">密码学安全伪随机数生成器</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/prng/problem/">题目</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">线性同余生成器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/lcg/intro/">简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/lcg/challenge/">例题</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">反馈移位寄存器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/fsr/intro/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/fsr/lfsr/">线性反馈移位寄存器</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/fsr/nfsr/">非线性反馈移位寄存器</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">特殊流密码</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../streamcipher/special/rc4/">RC4</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">块加密</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../blockcipher/introduction/">块加密简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../blockcipher/arx-operations/">ARX</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../blockcipher/des/">DES</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../blockcipher/idea/">IDEA</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../blockcipher/aes.md">AES</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../blockcipher/simon-speck/">Simon and Speck</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">分组模式</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/introduction/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/padding/">填充方式</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/ecb/">ECB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/cbc/">CBC</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/pcbc/">PCBC</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/cfb/">CFB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/ofb/">OFB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/ctr/">CTR</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../blockcipher/mode/padding-oracle-attack/">Padding Oracle Attack</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">非对称加密</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../introduction/">非对称加密简介</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">RSA</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../rsa_theory/">RSA 基本介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../rsa_module_attack/">模数相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../rsa_e_attack/">公钥指数相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../rsa_d_attack/">私钥 d 相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="" href="../rsa_coppersmith_attack.md">Coppersmith 相关攻击</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="./">选择明密文攻击</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#select-plaintext-attack">Select plaintext attack</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#any-ciphertext-decryption">Any ciphertext decryption</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#rsa-parity-oracle">RSA parity oracle</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#rsa-byte-oracle">RSA Byte Oracle</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#reference">Reference</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../rsa_side_channel/">侧信道攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../rsa_pkcs_attack/">Bleichenbacher 攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../rsa_complex/">综合</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../knapsack/knapsack/">背包加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">离散对数相关</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../discrete-log/discrete-log/">离散对数</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../discrete-log/elgamal/">Elgamal</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../discrete-log/ecc/">ECC</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">格密码</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../lattice/overview/">格概述</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../lattice/introduction/">格介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../lattice/lattice-reduction/">格基规约算法</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../lattice/cvp/">CVP</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">哈希函数</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../hash/introduction/">哈希函数简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../hash/md5/">MD5</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../hash/sha1/">SHA1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../hash/fnv/">FNV</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../hash/attack/">Hash Attack</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../hash/complex/">综合</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">数字签名</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../signature/introduction/">数字签名简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../signature/rsa/">RSA 数字签名</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../../signature/elgamal.md">ElGamal 数字签名</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../signature/dsa/">DSA 数字签名</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">攻击思想总结</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../attack-summary/attack-mode/">简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../attack-summary/meet-in-the-middle/">中间相遇攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../attack-summary/bit-attack/">比特攻击</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../../about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">西山下,闻溪语,书心境</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>RSA &raquo;</li>
        
      
        
          <li>非对称加密 &raquo;</li>
        
      
        
          <li>Crypto &raquo;</li>
        
      
    
    <li>选择明密文攻击</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><a href="./">EN</a> | <a href="../rsa_chosen_plain_cipher-zh/">ZH</a></p>
<h1 id="rsa-selecting-a-clear-ciphertext-attack">RSA Selecting a clear ciphertext attack<a class="headerlink" href="#rsa-selecting-a-clear-ciphertext-attack" title="Permanent link">&para;</a></h1>
<h2 id="select-plaintext-attack">Select plaintext attack<a class="headerlink" href="#select-plaintext-attack" title="Permanent link">&para;</a></h2>
<p>Here is an example, if we have an encryption oracle, but we don&#39;t know n and e, then</p>
<ol>
<li>We can get n by encrypting oracle.</li>
<li>When e is small ( <span><span class="MathJax_Preview">e&lt;2^{64}</span><script type="math/tex">e&lt;2^{64}</script></span>), we can use the <em>Pollard&#39;s kangaroo algorithm</em> algorithm to get e. This is more obvious.</li>
</ol>
<p>We can encrypt 2, 4, 8, and 16. Then we can know</p>
<p>$ C_2 = 2 ^ {e}  n $ way</p>
<p>C_4 = $ 4 ^ {e}  n $ way</p>
<p>$ C_8 = 8 ^ {e}  n $ way</p>
<p>Then</p>
<p><span><span class="MathJax_Preview">c_2^2 \equiv c_4 \bmod n</span><script type="math/tex">c_2^2 \equiv c_4 \bmod n</script></span></p>
<p><span><span class="MathJax_Preview">c_2^3 \equiv c_8 \bmod n</span><script type="math/tex">c_2^3 \equiv c_8 \bmod n</script></span></p>
<p>Therefore</p>
<p><span><span class="MathJax_Preview">c_2^2-c_4=kn</span><script type="math/tex">c_2^2-c_4=kn</script></span></p>
<p>$ c_2 ^ 3-c_8 = tn $</p>
<p>We can find the greatest common factor of kn and tn, and the big probability is n. We can also construct more examples to find n more deterministically.</p>
<h2 id="any-ciphertext-decryption">Any ciphertext decryption<a class="headerlink" href="#any-ciphertext-decryption" title="Permanent link">&para;</a></h2>
<p>Suppose Alice creates the ciphertext <span><span class="MathJax_Preview">C = P^e \bmod n</span><script type="math/tex">C = P^e \bmod n</script></span> and sends C to Bob, and assuming we want to decrypt any ciphertext encrypted by Alice, instead of just decrypting C, then we can intercept C, and use the following steps to find P:</p>
<ol>
<li>Select any <span><span class="MathJax_Preview">X\in Z_n^{*}</span><script type="math/tex">X\in Z_n^{*}</script></span>, ie X and N.</li>
<li>Calculate <span><span class="MathJax_Preview">Y=C \times X^e \bmod n</span><script type="math/tex">Y=C \times X^e \bmod n</script></span></li>
<li>Since we can choose to ciphertext attack, we find the decryption result corresponding to Y<span><span class="MathJax_Preview">Z=Y^d</span><script type="math/tex">Z=Y^d</script></span></li>
<li>Then, since <span><span class="MathJax_Preview">Z=Y^d=(C \times X^e)^d=C^d X=P^{ed} X= PX\bmod n</span><script type="math/tex">Z=Y^d=(C \times X^e)^d=C^d X=P^{ed} X= PX\bmod n</script></span>, since X and N are mutually prime, we are very It is easy to find the corresponding inverse element, and then you can get P</li>
</ol>
<h2 id="rsa-parity-oracle">RSA parity oracle<a class="headerlink" href="#rsa-parity-oracle" title="Permanent link">&para;</a></h2>
<p>Suppose there is currently an Oracle that decrypts a given ciphertext and checks the parity of the decrypted plaintext and returns the corresponding value based on parity, such as 1 for odd numbers and 0 for even numbers. Then given an encrypted ciphertext, we only need log(N) times to know the plaintext message corresponding to this ciphertext.</p>
<h3 id="principle">Principle<a class="headerlink" href="#principle" title="Permanent link">&para;</a></h3>
<p>Hypothesis</p>
<p>P $ C = e ^  N $ way</p>
<p>The first time we can send to the server</p>
<p>$ C * 2 ^ = e (2P) e ^  N $ way</p>
<p>The server will calculate</p>
<p>2P $  N $ way</p>
<p>Here</p>
<ul>
<li>2P is an even number and its power is even.</li>
<li>N is an odd number because it is multiplied by two large prime numbers.</li>
</ul>
<p>Then</p>
<ul>
<li>The server returns an odd number, ie <span><span class="MathJax_Preview">2P \bmod N</span><script type="math/tex">2P \bmod N</script></span> is an odd number, indicating that 2P is greater than N, and an odd number of Ns is subtracted, and because <span><span class="MathJax_Preview">2P&lt;2N</span><script type="math/tex">2P&lt;2N</script></span>, an N is subtracted, ie <span><span class="MathJax_Preview">\frac{N }{2} \leq P &lt; N</span><script type="math/tex">\frac{N }{2} \leq P &lt; N</script></span>, we can also consider rounding down.</li>
<li>If the server returns an even number, then 2P is less than N. That is, <span><span class="MathJax_Preview">0\leq P &lt; \frac{N}{2}</span><script type="math/tex">0\leq P &lt; \frac{N}{2}</script></span>, we can also round down.</li>
</ul>
<p>Here we use mathematical induction, which assumes that at the ith time, <span><span class="MathJax_Preview">\frac{xN}{2^{i}} \leq P &lt; \frac{xN+N}{2^{i}}</span><script type="math/tex">\frac{xN}{2^{i}} \leq P &lt; \frac{xN+N}{2^{i}}</script></span></p>
<p>Further, at the i+1th time, we can send</p>
<p><span><span class="MathJax_Preview">C*2^{(i+1)e}</span><script type="math/tex">C*2^{(i+1)e}</script></span></p>
<p>The server will calculate</p>
<p>$ 2 ^ {i + 1} P  way N = 2 ^ {i + 1} P $ kN</p>
<p><span><span class="MathJax_Preview">0 \leq 2^{i+1}P-kN&lt;N</span><script type="math/tex">0 \leq 2^{i+1}P-kN<N</script></span> </p>
<p>$  frac {kN} {2 ^ {i + 1}}  leq P &lt; frac {kN + N}</p>
<p>According to the result of the ith</p>
<p><span><span class="MathJax_Preview">\frac{2xN}{2^{i+1}} \leq P &lt; \frac{2xN+2N}{2^{i+1}}</span><script type="math/tex">\frac{2xN}{2^{i+1}} \leq P < \frac{2xN+2N}{2^{i+1}}</script></span></p>
<p>Then</p>
<ul>
<li>If the server returns an odd number, then k must be an odd number, k=2y+1, then <span><span class="MathJax_Preview">\frac{2yN+N}{2^{i+1}} \leq P &lt; \frac{2yN+2N}{2^ {i+1}}</span><script type="math/tex">\frac{2yN+N}{2^{i+1}} \leq P &lt; \frac{2yN+2N}{2^ {i+1}}</script></span>. At the same time, since P necessarily exists, the range obtained by the i+1 and the range obtained by the i-th must have an intersection. So y must be equal to x.</li>
<li>If the server returns an even number, then k must be an even number, k=2y, where y must also be equal to x, then <span><span class="MathJax_Preview">\frac{2xN}{2^{i+1}} \leq P &lt; \frac{2xN+ N}{2^{i+1}}</span><script type="math/tex">\frac{2xN}{2^{i+1}} \leq P &lt; \frac{2xN+ N}{2^{i+1}}</script></span></li>
</ul>
<p>Further we can conclude</p>
<div class="highlight"><pre><span></span><code><span class="n">lb</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">ub</span> <span class="o">=</span> <span class="n">N</span>
<span class="k">if</span> <span class="n">server</span> <span class="n">returns</span> <span class="mi">1</span>

<span class="n">lb</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span> <span class="o">+</span> <span class="n">ub</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="k">else</span><span class="o">:</span>

<span class="n">UB</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ib</span> <span class="o">+</span> <span class="n">UB</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</code></pre></div>

<p>Although it is divisible, that is, it is rounded down, but it does not matter that we have analyzed this problem at the beginning.</p>
<h3 id="2018-google-ctf-perfect-secrecy">2018 Google CTF Perfect Secrecy<a class="headerlink" href="#2018-google-ctf-perfect-secrecy" title="Permanent link">&para;</a></h3>
<p>Here is an example of the 2018 Google CTF topic.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">random</span>



<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives</span> <span class="kn">import</span> <span class="n">serialization</span>

<span class="kn">from</span> <span class="nn">cryptography.hazmat.backends</span> <span class="kn">import</span> <span class="n">default_backend</span>





<span class="k">def</span> <span class="nf">ReadPrivateKey</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

  <span class="k">return</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_private_key</span><span class="p">(</span>

      <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">default_backend</span><span class="p">())</span>





<span class="k">def</span> <span class="nf">RsaDecrypt</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="n">ciphertext</span><span class="p">):</span>

  <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span> <span class="o">&lt;=</span>

          <span class="p">(</span><span class="n">private_key</span><span class="o">.</span><span class="n">public_key</span><span class="p">()</span><span class="o">.</span><span class="n">key_size</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)),</span> <span class="s1">&#39;Ciphertext too large&#39;</span>
  <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span>

      <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">),</span>

      <span class="n">private_key</span><span class="o">.</span><span class="n">private_numbers</span><span class="p">()</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>

      <span class="n">private_key</span><span class="o">.</span><span class="n">public_key</span><span class="p">()</span><span class="o">.</span><span class="n">public_numbers</span><span class="p">()</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">Challenge</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">):</span>

  <span class="k">try</span><span class="p">:</span>

    <span class="n">m0</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">m1</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">private_key</span><span class="o">.</span><span class="n">public_key</span><span class="p">()</span><span class="o">.</span><span class="n">key_size</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span>

    <span class="n">dice</span> <span class="o">=</span> <span class="n">RsaDecrypt</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="n">ciphertext</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">rounds</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>

      <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">m0</span><span class="p">,</span> <span class="n">m1</span><span class="p">][</span><span class="n">dice</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">word</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">%</span> <span class="mi">2</span>
      <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">((</span><span class="n">c</span><span class="p">,)))</span>

    <span class="n">writer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">return</span> <span class="mi">0</span>



  <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

    <span class="k">return</span> <span class="mi">1</span>





<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

  <span class="n">private_key</span> <span class="o">=</span> <span class="n">ReadPrivateKey</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

  <span class="k">return</span> <span class="n">Challenge</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>





<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>

<p>As can be seen</p>
<ul>
<li>We can give the server two numbers, and the server will decide which one to use based on the decrypted ciphertext content.</li>
<li>The server will use <code>random.randint(0, 2)</code> to generate a random number and output the associated random 01 byte c.</li>
</ul>
<p>At first glance, it seems to be completely random. Check out <code>random.randint(0, 2)</code> to know that the generated random number is bounded, so the probability of generating an even number is greater than the probability of generating an odd number, then c and p The probability of the same parity is &#8532;. Furthermore, by setting m0 and m1, we can know whether the last digit of the decrypted ciphertext is 0 or 1. This is actually the RSA parity oracle.</p>
<p>Exp is as follows</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">encflag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./flag.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">encflag</span> <span class="o">=</span> <span class="n">encflag</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>

<span class="n">encflag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">encflag</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="c1">#context.log_level = &#39;debug&#39;</span>

<span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x07</span><span class="s1">&#39;</span><span class="p">]</span>

<span class="n">n</span> <span class="o">=</span> <span class="mh">0xDA53A899D5573091AF6CC9C9A9FC315F76402C8970BBB1986BFE8E29CED12D0ADF61B21D6C281CCBF2EFED79AA7DD23A2776B03503B1AF354E35BF58C91DB7D7C62F6B92C918C90B68859C77CAE9FDB314F82490A0D6B50C5DC85F5C92A6FDF19716AC8451EFE8BBDF488AE098A7C76ADD2599F2CA642073AFA20D143AF403D1</span>

<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>







<span class="k">def</span> <span class="nf">guessvalue</span><span class="p">(</span><span class="n">cnt</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>

        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="mi">1</span>





<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

    <span class="n">cnt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="n">cnt</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;perfect-secrecy.ctfcompetition.com&#39;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="n">two_inv</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="n">two_cipher</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">powmod</span><span class="p">(</span><span class="n">two_inv</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="n">encflag</span> <span class="o">*</span> <span class="n">two_cipher</span> <span class="o">%</span> <span class="n">n</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">tmp</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">256</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="o">+</span> <span class="n">tmp</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span> <span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">128</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1">#print tmp</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">):</span>

        <span class="n">data</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

<span class="n">cnt</span> <span class="p">[</span><span class="n">U8</span> <span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">+</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">flag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">guessvalue</span><span class="p">(</span><span class="n">cnt</span><span class="p">))</span> <span class="o">+</span> <span class="n">flag</span>

    <span class="nb">print</span> <span class="n">i</span><span class="p">,</span> <span class="n">flag</span>

    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>

<p>Results are as follows</p>
<div class="highlight"><pre><span></span><code><span class="m">6533021797450432625003726192285181680054061843303961161444459679874621880787893445342698029728203298974356255732086344166897556918532195998159983477294838449903429031335408290610431938507208444225296242342845578895553611385588996615744823221415296689514934439749745119968629875229882861818946483594948270</span> <span class="m">6533021797450432625003726192285181680054061843303961161444459679874621880787893445342698029728203298974356255732086344166897556918532195998159983477294838449903429031335408290610431938507208444225296242342845578895553611385588996615744823221415296689514934439749745119968629875229882861818946483594948270</span>
</code></pre></div>

<p>After decoding, you can get flag</p>
<div class="highlight"><pre><span></span><code>CTF <span class="o">{</span>h3ll0__17_5_m3_1_w45_w0nd3r1n6_1f_4f73r_4ll_7h353_y34r5_y0u_d_l1k3_70_m337<span class="o">}</span>
</code></pre></div>

<h3 id="title">Title<a class="headerlink" href="#title" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>2016 Plaid CTF rabit</p>
</li>
<li>
<p>2016 sharif CTF lsb-oracle-150</p>
</li>
<li>
<p>2018 Backdoor CTF  BIT-LEAKER</p>
</li>
<li>
<p>2018 XMAN trials baby RSA</p>
</li>
</ul>
<h2 id="rsa-byte-oracle">RSA Byte Oracle<a class="headerlink" href="#rsa-byte-oracle" title="Permanent link">&para;</a></h2>
<p>Suppose there is currently an Oracle that decrypts a given ciphertext and gives the last byte of the plaintext. Then given an encrypted ciphertext, we only need <span><span class="MathJax_Preview">\log_{256}n</span><script type="math/tex">\log_{256}n</script></span> times to know the plaintext message corresponding to this ciphertext.</p>
<h3 id="principle_1">Principle<a class="headerlink" href="#principle_1" title="Permanent link">&para;</a></h3>
<p>This is actually an extension of RSA parity Oracle. Since the last byte can be revealed, then the number of times we get the ciphertext corresponding plaintext should be reduced.</p>
<p>Hypothesis</p>
<p>P $ C = e ^  N $ way</p>
<p>The first time we can send to the server</p>
<p>C $ 256 * e ^ = (256P) e ^  N $ way</p>
<p>The server will calculate</p>
<p>256P $  N $ way</p>
<p>Here</p>
<ul>
<li>256P is an even number.</li>
<li>N is an odd number because it is multiplied by two large prime numbers.</li>
</ul>
<p>Since P is generally less than N, then <span><span class="MathJax_Preview">256P \bmod N=256P-kn, k&lt;256</span><script type="math/tex">256P \bmod N=256P-kn, k&lt;256</script></span>. And for two different <span><span class="MathJax_Preview">k_1, k_2</span><script type="math/tex">k_1, k_2</script></span>, we have</p>
<p><span><span class="MathJax_Preview">256P-k_1n \not\equiv 256P-k_2n \bmod 256</span><script type="math/tex">256P-k_1n \not\equiv 256P-k_2n \bmod 256</script></span></p>
<p>We can use the counter-evidence method to prove the above inequality. At the same time, the last byte of <span><span class="MathJax_Preview">256P-kn</span><script type="math/tex">256P-kn</script></span> is actually <span><span class="MathJax_Preview">-kn</span><script type="math/tex">-kn</script></span> obtained in the case of modulo 256. So, in fact, we can first enumerate the last byte in the case of 0~255, construct a mapping table of k and the last byte.</p>
<p>When the server returns the last byte b, we can know k according to the mapping table constructed above, that is, subtract k N, that is, <span><span class="MathJax_Preview">kN \leq 256 P \leq (k+1)N</span><script type="math/tex">kN \leq 256 P \leq (k+1)N</script></span>.</p>
<p>After that, we use mathematical induction to obtain the range of P, that is, assume that at the ith time, <span><span class="MathJax_Preview">\frac{xN}{256^{i}} \leq P &lt; \frac{xN+N}{256^{i }}</span><script type="math/tex">\frac{xN}{256^{i}} \leq P &lt; \frac{xN+N}{256^{i }}</script></span></p>
<p>Further, at the i+1th time, we can send</p>
<p><span><span class="MathJax_Preview">C*256^{(i+1)e}</span><script type="math/tex">C*256^{(i+1)e}</script></span></p>
<p>The server will calculate</p>
<p>$ 256 ^ {i + 1} P  way N = 256 ^ {i + 1} P $ kN</p>
<p><span><span class="MathJax_Preview">0 \leq 256^{i+1}P-kN&lt;N</span><script type="math/tex">0 \leq 256^{i+1}P-kN<N</script></span> </p>
<p>$  frac {kN} {256} {i + 1}}  leq P &lt; frac {kN + N}</p>
<p>According to the result of the ith</p>
<p><span><span class="MathJax_Preview">\frac{256xN}{256^{i+1}} \leq P &lt; \frac{256xN+256N}{256^{i+1}}</span><script type="math/tex">\frac{256xN}{256^{i+1}} \leq P < \frac{256xN+256N}{256^{i+1}}</script></span></p>
<p>We can assume <span><span class="MathJax_Preview">k=256y+t</span><script type="math/tex">k=256y+t</script></span> here, and the t here is what we can get through the mapping table.</p>
<p><span><span class="MathJax_Preview">\frac{256yN+tN}{256^{i+1}} \leq P &lt; \frac{256yN+(t+1)N}{256^{i+1}}</span><script type="math/tex">\frac{256yN+tN}{256^{i+1}} \leq P < \frac{256yN+(t+1)N}{256^{i+1}}</script></span></p>
<p>At the same time, since P necessarily exists, the range obtained by the i+1 and the range obtained by the i-th must have an intersection.</p>
<p>So y must be equal to x.</p>
<p>Further we can summarize this, in the initial case</p>
<div class="highlight"><pre><span></span><code>lb = 0

ub = N
</code></pre></div>

<p>Suppose the server returns b, then</p>
<div class="highlight"><pre><span></span><code><span class="n">k</span> <span class="o">=</span> <span class="n">mab</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span>
<span class="n">interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">ub</span><span class="o">-</span><span class="n">lb</span><span class="p">)</span><span class="o">/</span><span class="mi">256</span>

<span class="n">lb</span> <span class="o">=</span> <span class="n">lb</span> <span class="o">+</span> <span class="n">interval</span> <span class="o">*</span> <span class="n">k</span>

<span class="n">ub</span> <span class="o">=</span> <span class="n">lb</span> <span class="o">+</span> <span class="n">interval</span>
</code></pre></div>

<h3 id="2018-hitcon-lost-key">2018 HITCON lost key<a class="headerlink" href="#2018-hitcon-lost-key" title="Permanent link">&para;</a></h3>
<p>This is a comprehensive topic. First, we don&#39;t give n. We can use the method of selecting a plaintext attack to get n. Of course, we can further obtain e. Finally, the code is as follows.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">gmpy2</span>

<span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./rsa.py&#39;</span><span class="p">)</span>

<span class="c1">#p = remote(&#39;18.179.251.168&#39;, 21700)</span>

<span class="c1">#context.log_level = &#39;debug&#39;</span>

<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;Here is the flag!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">flagcipher</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>





<span class="k">def</span> <span class="nf">long_to_hex</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>

    <span class="n">s</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">n</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">s</span>

    <span class="k">return</span> <span class="n">s</span>





<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;cmd: &#39;</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;input: &#39;</span><span class="p">,</span> <span class="n">long_to_hex</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>





<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># get n</span>

    <span class="n">cipher2</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">cipher4</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">nset</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">nset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cipher2</span> <span class="o">*</span> <span class="n">cipher2</span> <span class="o">-</span> <span class="n">cipher4</span><span class="p">)</span>



    <span class="n">cipher3</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">cipher9</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="n">nset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cipher3</span> <span class="o">*</span> <span class="n">cipher3</span> <span class="o">-</span> <span class="n">cipher9</span><span class="p">)</span>

    <span class="n">cipher5</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

    <span class="n">cipher25</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

    <span class="n">nset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cipher5</span> <span class="o">*</span> <span class="n">cipher5</span> <span class="o">-</span> <span class="n">cipher25</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">nset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nset</span><span class="p">:</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>



    <span class="c1"># get map between k and return byte</span>

    <span class="n">submap</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">):</span>

        <span class="n">submap</span><span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="o">*</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>



    <span class="c1"># get cipher256</span>

    <span class="n">cipher256</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>



    <span class="n">back</span> <span class="o">=</span> <span class="n">flagcipher</span>



    <span class="n">L</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>

        <span class="nb">print</span> <span class="n">i</span>

        <span class="n">flagcipher</span> <span class="o">=</span> <span class="n">flagcipher</span> <span class="o">*</span> <span class="n">cipher256</span> <span class="o">%</span> <span class="n">n</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">flagcipher</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">submap</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

        <span class="n">L</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">L</span> <span class="o">+</span> <span class="p">(</span><span class="n">R</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">256</span>

                                     <span class="p">),</span> <span class="n">L</span> <span class="o">+</span> <span class="p">(</span><span class="n">R</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">*</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>

    <span class="n">low</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">L</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>

    <span class="nb">print</span> <span class="n">long_to_hex</span><span class="p">(</span><span class="n">low</span> <span class="o">-</span> <span class="n">low</span> <span class="o">%</span> <span class="mi">256</span> <span class="o">+</span> <span class="n">send</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">back</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
</code></pre></div>

<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><a href="https://crypto.stackexchange.com/questions/11053/rsa-least-significant-bit-oracle-attack">https://crypto.stackexchange.com/questions/11053/rsa-least-significant-bit-oracle-attack</a></p>
</li>
<li>
<p><a href="https://pastebin.com/KnEUSMxp">https://pastebin.com/KnEUSMxp</a></p>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../rsa_side_channel/" class="btn btn-neutral float-right" title="侧信道攻击">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../rsa_d_attack/" class="btn btn-neutral" title="私钥 d 相关攻击"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../rsa_d_attack/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../rsa_side_channel/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
      <script src="../../../../_static/js/extra.js" defer></script>
      <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
