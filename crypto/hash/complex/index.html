<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>综合 - 西山下,闻溪语,书心境</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../../css/theme.css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u7efc\u5408";
    var mkdocs_page_input_path = "crypto/hash/complex.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> 西山下,闻溪语,书心境</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">Index</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../..">首页</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../../about/">关于我</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Crypto</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../../introduction/">密码学简介</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">基础数学知识</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../basic/introduction/">简介</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">古典密码</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/introduction/">古典密码简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/monoalphabetic/">单表代换加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/polyalphabetic/">多表代换加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/others/">其他类型加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/summary/">总结</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">流密码</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../streamcipher/intro/">介绍</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">伪随机数生成器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/intro/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/csprng/">密码学安全伪随机数生成器</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/problem/">题目</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">线性同余生成器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/lcg/intro/">简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/lcg/challenge/">例题</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">反馈移位寄存器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/intro/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/lfsr/">线性反馈移位寄存器</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/nfsr/">非线性反馈移位寄存器</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">特殊流密码</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/special/rc4/">RC4</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">块加密</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/introduction/">块加密简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/arx-operations/">ARX</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/des/">DES</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/idea/">IDEA</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../blockcipher/aes.md">AES</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../blockcipher/simon-speck/">Simon and Speck</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">分组模式</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/introduction/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/padding/">填充方式</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/ecb/">ECB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/cbc/">CBC</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/pcbc/">PCBC</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/cfb/">CFB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/ofb/">OFB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/ctr/">CTR</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../blockcipher/mode/padding-oracle-attack/">Padding Oracle Attack</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">非对称加密</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../asymmetric/introduction/">非对称加密简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">RSA</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_theory/">RSA 基本介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_module_attack/">模数相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_e_attack/">公钥指数相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_d_attack/">私钥 d 相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../asymmetric/rsa/rsa_coppersmith_attack.md">Coppersmith 相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_chosen_plain_cipher/">选择明密文攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_side_channel/">侧信道攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_pkcs_attack/">Bleichenbacher 攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_complex/">综合</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../asymmetric/knapsack/knapsack/">背包加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">离散对数相关</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/discrete-log/">离散对数</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/elgamal/">Elgamal</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/ecc/">ECC</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">格密码</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/overview/">格概述</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/introduction/">格介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/lattice-reduction/">格基规约算法</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/cvp/">CVP</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">哈希函数</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../introduction/">哈希函数简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../md5/">MD5</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../sha1/">SHA1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../fnv/">FNV</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../attack/">Hash Attack</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="./">综合</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#2017-34c3-software_update">2017 34c3 Software_update</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#references">references</a>
    </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">数字签名</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/introduction/">数字签名简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/rsa/">RSA 数字签名</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../signature/elgamal.md">ElGamal 数字签名</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/dsa/">DSA 数字签名</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">攻击思想总结</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../attack-summary/attack-mode/">简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../attack-summary/meet-in-the-middle/">中间相遇攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../attack-summary/bit-attack/">比特攻击</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">西山下,闻溪语,书心境</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>哈希函数 &raquo;</li>
        
      
        
          <li>非对称加密 &raquo;</li>
        
      
        
          <li>Crypto &raquo;</li>
        
      
    
    <li>综合</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><a href="./">EN</a> | <a href="../complex-zh/">ZH</a></p>
<h1 id="_1">综合<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="2017-34c3-software_update">2017 34c3 Software_update<a class="headerlink" href="#2017-34c3-software_update" title="Permanent link">&para;</a></h2>
<p>As you can see, the general meaning of the program is to upload a zip archive and then verify the signature of the files in the signed_data directory. Among them, the final verification method is to perform a sha256 hash on each file, and then XOR X is sent as input to rsa for signature. If verified, the corresponding pre-copy.py and post-copy.py files will be executed.</p>
<p>The natural idea is that we modify the pre-copy.py or post-copy.py file so that it can read the flag and then bypass the signature again. There are two main ideas</p>
<ol>
<li>According to the given public key file to obtain the corresponding private key, and then modify the file to forge the signature, and then look at the public key file is almost unbreakable, so this can basically give up.</li>
<li>After modifying the corresponding file, use the XOR feature to make its hash value the same as the original **, thus bypassing the signature detection. That is, the signed_data directory contains multiple files, so that the hash values of these files are finally XORed to offset the difference in hash values caused by modifying the pre-copy.py or post-copy.py files.</li>
</ol>
<p>Here, we choose the second method, here we choose to modify the pre-copy.py file, the specific ideas are as follows</p>
<ol>
<li>Calculate the original hash value of pre-copy.py.</li>
<li>Modify the pre-copy.py file so that it can read the flag. At the same time, calculate the new hash value. XOR the two and find the difference or delta.</li>
<li>Look for a series of files whose X-values are XORed exactly as delta.</li>
</ol>
<p>The key step is the third step, but in fact this file can be seen as a linear combination problem, that is, looking for several 256-dimensional 01 vectors to make the XOR value delta. and
$$</p>
<p>(F={0,1},F^{256},\oplus ,\cdot)</p>
<p>$$</p>
<p>Is a 256-dimensional vector space. If we can find a basis for the vector space, then we can find the required vector for any given value in the space.</p>
<p>We can use sage to assist us, as follows</p>
<div class="highlight"><pre><span></span><code><span class="c1"># generage the base of &lt;{0,1},F^256,xor,*&gt;</span>

<span class="k">def</span> <span class="nf">gen_gf2_256_base</span><span class="p">():</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">VectorSpace</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">256</span><span class="p">)</span>

    <span class="n">tmphash</span> <span class="o">=</span> <span class="n">compute_file_hash</span><span class="p">(</span><span class="s2">&quot;0.py&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">tmphash_bin</span> <span class="o">=</span> <span class="n">hash2bin</span> <span class="p">(</span><span class="n">tmphash</span><span class="p">)</span>
    <span class="n">base</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmphash_bin</span><span class="p">]</span>

    <span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0.py&#39;</span><span class="p">]</span>

    <span class="nb">print</span> <span class="n">base</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

    <span class="n">dim</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span>

    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">256</span><span class="p">:</span>

        <span class="n">tmpfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.py&quot;</span>

        <span class="n">tmphash</span> <span class="o">=</span> <span class="n">compute_file_hash</span><span class="p">(</span><span class="n">tmpfile</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">tmphash_bin</span> <span class="o">=</span> <span class="n">hash2bin</span> <span class="p">(</span><span class="n">tmphash</span><span class="p">)</span>
        <span class="n">old_dim</span> <span class="o">=</span> <span class="n">dim</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="p">[</span><span class="n">tmphash_bin</span><span class="p">])</span>

        <span class="n">dim</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dim</span> <span class="o">&gt;</span> <span class="n">old_dim</span><span class="p">:</span>

            <span class="n">base</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tmphash_bin</span><span class="p">]</span>

            <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpfile</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dimension &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dimension</span><span class="p">()))</span>

        <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">filelist</span>
</code></pre></div>

<p>For more detailed answers, please refer to <code>exp.py</code>.</p>
<p>Here I am modifying the pre-copy multi-output <code>!!!!come here!!!!</code> word, as follows</p>
<div class="highlight"><pre><span></span><code>➜  software_update git:<span class="o">(</span>master<span class="o">)</span> python3 installer.py now.zip

Preparing to copy data...

!!!!come here!!!!

Software update installed successfully.
</code></pre></div>

<h2 id="references">references<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><a href="https://sectt.github.io/writeups/34C3CTF/crypto_182_software_update/Readme">https://sectt.github.io/writeups/34C3CTF/crypto_182_software_update/Readme</a></p>
</li>
<li>
<p><a href="https://github.com/OOTS/34c3ctf/blob/master/software_update/solution/exploit.py">https://github.com/OOTS/34c3ctf/blob/master/software_update/solution/exploit.py</a></p>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../signature/introduction/" class="btn btn-neutral float-right" title="数字签名简介">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../attack/" class="btn btn-neutral" title="Hash Attack"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../attack/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../signature/introduction/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
      <script src="../../../_static/js/extra.js" defer></script>
      <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
