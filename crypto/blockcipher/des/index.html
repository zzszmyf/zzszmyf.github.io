<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>DES - 西山下,闻溪语,书心境</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../../css/theme.css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "DES";
    var mkdocs_page_input_path = "crypto/blockcipher/des.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> 西山下,闻溪语,书心境</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../..">Index</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Crypto</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../../introduction/">密码学简介</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">基础数学知识</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../basic/introduction/">简介</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">古典密码</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/introduction/">古典密码简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/monoalphabetic/">单表代换加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/polyalphabetic/">多表代换加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/others/">其他类型加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../classical/summary/">总结</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">流密码</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../streamcipher/intro/">介绍</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">伪随机数生成器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/intro/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/csprng/">密码学安全伪随机数生成器</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/prng/problem/">题目</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">线性同余生成器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/lcg/intro/">简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/lcg/challenge/">例题</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">反馈移位寄存器</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/intro/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/lfsr/">线性反馈移位寄存器</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/fsr/nfsr/">非线性反馈移位寄存器</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">特殊流密码</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../streamcipher/special/rc4/">RC4</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">块加密</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../introduction/">块加密简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../arx-operations/">ARX</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">DES</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#basic-introduction">basic introduction</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#basic-process">Basic Process</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#encryption">Encryption</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#decryption">Decryption</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#core-components">Core components</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#derivative">derivative</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#dual-des">Dual DES</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#triple-des">Triple DES</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#attack-method">Attack method</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2018-n1ctf-n1es">2018 N1CTF N1ES</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2019-ciscn-part_des">2019 CISCN part_des</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#reference">Reference</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../idea/">IDEA</a>
                </li>
                <li class="toctree-l2"><a class="" href="../aes.md">AES</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../simon-speck/">Simon and Speck</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">分组模式</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../mode/introduction/">介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../mode/padding/">填充方式</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../mode/ecb/">ECB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../mode/cbc/">CBC</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../mode/pcbc/">PCBC</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../mode/cfb/">CFB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../mode/ofb/">OFB</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../mode/ctr/">CTR</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../mode/padding-oracle-attack/">Padding Oracle Attack</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">非对称加密</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../asymmetric/introduction/">非对称加密简介</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">RSA</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_theory/">RSA 基本介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_module_attack/">模数相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_e_attack/">公钥指数相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_d_attack/">私钥 d 相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../asymmetric/rsa/rsa_coppersmith_attack.md">Coppersmith 相关攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_chosen_plain_cipher/">选择明密文攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_side_channel/">侧信道攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_pkcs_attack/">Bleichenbacher 攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/rsa/rsa_complex/">综合</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../asymmetric/knapsack/knapsack/">背包加密</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">离散对数相关</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/discrete-log/">离散对数</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/elgamal/">Elgamal</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/discrete-log/ecc/">ECC</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">格密码</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/overview/">格概述</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/introduction/">格介绍</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/lattice-reduction/">格基规约算法</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../asymmetric/lattice/cvp/">CVP</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">哈希函数</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/introduction/">哈希函数简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/md5/">MD5</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/sha1/">SHA1</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/fnv/">FNV</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/attack/">Hash Attack</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../hash/complex/">综合</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">数字签名</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/introduction/">数字签名简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/rsa/">RSA 数字签名</a>
                </li>
                <li class="toctree-l3"><a class="" href="../../signature/elgamal.md">ElGamal 数字签名</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../signature/dsa/">DSA 数字签名</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">攻击思想总结</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../attack-summary/attack-mode/">简介</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../attack-summary/meet-in-the-middle/">中间相遇攻击</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../attack-summary/bit-attack/">比特攻击</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">西山下,闻溪语,书心境</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>块加密 &raquo;</li>
        
      
        
          <li>Crypto &raquo;</li>
        
      
    
    <li>DES</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><a href="./">EN</a> | <a href="../des-zh/">ZH</a></p>
<h1 id="des">DES<a class="headerlink" href="#des" title="Permanent link">&para;</a></h1>
<h2 id="basic-introduction">basic introduction<a class="headerlink" href="#basic-introduction" title="Permanent link">&para;</a></h2>
<p>Data Encryption Standard (DES), a data encryption standard, is a typical block encryption. The basic information is as follows:</p>
<ul>
<li>Enter 64 bits.</li>
<li>Output 64 bits.</li>
<li>The key is 64 bits, using 56 bits of the 64-bit key, and the remaining 8 bits are either discarded or used as parity bits.</li>
<li>Feistel iterative structure</li>
<li>The plaintext is ciphered after 16 iterations.</li>
<li>The ciphertext is plaintext after a similar 16 iterations.</li>
</ul>
<h2 id="basic-process">Basic Process<a class="headerlink" href="#basic-process" title="Permanent link">&para;</a></h2>
<p>Give a simple [DES Flowchart] (<a href="http://homepage.usask.ca/~dtr467/400/">http://homepage.usask.ca/~dtr467/400/</a>).</p>
<p><img alt="" src="../figure/des.gif" /></p>
<h3 id="encryption">Encryption<a class="headerlink" href="#encryption" title="Permanent link">&para;</a></h3>
<p>We can consider each round of encryption process</p>
<p><span><span class="MathJax_Preview">L_{i+1}=R_i</span><script type="math/tex">L_{i+1}=R_i</script></span></p>
<p><span><span class="MathJax_Preview">R_{i+1}=L_i\oplus F(R_i,K_i)</span><script type="math/tex">R_{i+1}=L_i\oplus F(R_i,K_i)</script></span></p>
<p>Then before the last Permutation, the corresponding ciphertext is <span><span class="MathJax_Preview">(R_{n+1}, L_{n+1})</span><script type="math/tex">(R_{n+1}, L_{n+1})</script></span>.</p>
<h3 id="decryption">Decryption<a class="headerlink" href="#decryption" title="Permanent link">&para;</a></h3>
<p>So how does decryption decrypt it? First, we can reverse the ciphertext first, then we can get the final round of output. We will consider each round at this time.</p>
<p><span><span class="MathJax_Preview">R_i=L_{i+1}</span><script type="math/tex">R_i=L_{i+1}</script></span></p>
<p><span><span class="MathJax_Preview">L_i=R_{i+1}\oplus F(L_{i+1},K_i)</span><script type="math/tex">L_i=R_{i+1}\oplus F(L_{i+1},K_i)</script></span></p>
<p>Therefore, <span><span class="MathJax_Preview">(L_0,R_0)</span><script type="math/tex">(L_0,R_0)</script></span> is the plaintext after the first replacement when encrypting. We only need to perform the inverse permutation to get the plaintext.</p>
<p>It can be seen that DES encryption and decryption uses the same set of logic, except that the order in which the keys are used is inconsistent.</p>
<h2 id="core-components">Core components<a class="headerlink" href="#core-components" title="Permanent link">&para;</a></h2>
<p>The core components in DES mainly include (only the encryption process is given here)</p>
<ul>
<li>initial replacement</li>
<li>F function</li>
<li>E extension function</li>
<li>S box, design criteria not given.</li>
<li>P replacement</li>
<li>Last replacement</li>
</ul>
<p>Where the F function is as follows</p>
<p><img alt="" src="../figure/f-function.png" /></p>
<p>If you are more interested in DES, you can study it more closely. Welcome to PR.</p>
<h2 id="derivative">derivative<a class="headerlink" href="#derivative" title="Permanent link">&para;</a></h2>
<p>Based on DES, the following two encryption methods are derived.</p>
<ul>
<li>Double DES</li>
<li>Three DES</li>
</ul>
<h3 id="dual-des">Dual DES<a class="headerlink" href="#dual-des" title="Permanent link">&para;</a></h3>
<p>Dual DES uses two keys and is 112 bits long. Encryption method is as follows</p>
<p>$ C = E_ {k2} (E_ {k1} (P)) $</p>
<p>But dual DES can&#39;t resist the middle encounter attack, we can construct the following two sets</p>
<p>$ I = {E_ {k1} (P)} $</p>
<p><span><span class="MathJax_Preview">J=D_{k2}(C)</span><script type="math/tex">J=D_{k2}(C)</script></span></p>
<p>That is, respectively enumerate K1 and K2 to encrypt P and decrypt C respectively.</p>
<p>After we encrypt P, we can sort the encryption results. The complexity is <span><span class="MathJax_Preview">2^nlog(2^n)=O(n2^n)</span><script type="math/tex">2^nlog(2^n)=O(n2^n)</script></span></p>
<p>When we decrypt C, we can go to the corresponding table for each decryption.</p>
<p>The total complexity is still <span><span class="MathJax_Preview">O(n2^n)</span><script type="math/tex">O(n2^n)</script></span>.</p>
<h3 id="triple-des">Triple DES<a class="headerlink" href="#triple-des" title="Permanent link">&para;</a></h3>
<p>Triple DES encryption and decryption methods are as follows</p>
<p><span><span class="MathJax_Preview">C=E_{k3}(D_{k2}(E_{k1}(P)))</span><script type="math/tex">C=E_{k3}(D_{k2}(E_{k1}(P)))</script></span></p>
<p><span><span class="MathJax_Preview">P=D_{k1}(E_{k2}(D_{k3}(C)))</span><script type="math/tex">P=D_{k1}(E_{k2}(D_{k3}(C)))</script></span></p>
<p>There are two ways to choose a key.</p>
<ul>
<li>3 different keys, k1, k2, k3 are independent of each other, a total of 168 bits.</li>
<li>2 different keys, k1 and k2 are independent, k3 = k1, 112 bits.</li>
</ul>
<h2 id="attack-method">Attack method<a class="headerlink" href="#attack-method" title="Permanent link">&para;</a></h2>
<ul>
<li>Differential attack</li>
<li>Linear attack</li>
</ul>
<h2 id="2018-n1ctf-n1es">2018 N1CTF N1ES<a class="headerlink" href="#2018-n1ctf-n1es" title="Permanent link">&para;</a></h2>
<p>The basic code is as follows</p>
<div class="highlight"><pre><span></span><code><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="k">def</span> <span class="nf">round_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

    <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="n">y</span><span class="p">)</span>

<span class="n">true</span> <span class="o">=</span> <span class="o">&amp;</span><span class="c1">#39;&amp;#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>

<span class="n">res</span> <span class="o">+</span> <span class="o">=</span> <span class="nb">chr</span> <span class="p">(</span><span class="n">f</span> <span class="p">(</span><span class="n">words</span> <span class="p">(</span><span class="n">a</span> <span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">words</span> <span class="p">(</span><span class="n">b</span> <span class="p">[</span><span class="n">i</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">res</span>



<span class="k">def</span> <span class="nf">permutate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">block</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">table</span><span class="p">))</span>



<span class="k">def</span> <span class="nf">string_to_bits</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

<span class="n">l</span> <span class="o">=</span> <span class="nb">len</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">l</span>
<span class="n">post</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>

            <span class="n">result</span><span class="p">[(</span><span class="n">pos</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ch</span><span class="o">&gt;&gt;</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>

<span class="n">post</span> <span class="o">+</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>



<span class="n">s_box</span> <span class="o">=</span> <span class="p">[</span><span class="mi">54</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">8</span>

<span class="mi">9</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">159</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>

 <span class="mi">17</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">27</span><span class="p">]</span>



<span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">permutate</span> <span class="p">(</span><span class="n">s_box</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="mi">7</span><span class="p">):</span>

        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>

<span class="n">post</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>

            <span class="n">x</span> <span class="o">+=</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;&lt;</span><span class="n">pos</span><span class="p">)</span>

<span class="n">post</span> <span class="o">+</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mh">0x10001</span><span class="o">**</span><span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mh">0x7f</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">c</span>







<span class="k">class</span> <span class="nc">N1ES</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">24</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;key must be 24 bytes long&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gen_subkey</span><span class="p">()</span>



    <span class="k">def</span> <span class="nf">gen_subkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">o</span> <span class="o">=</span> <span class="n">string_to_bits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

<span class="n">k</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>

<span class="n">o</span> <span class="o">=</span> <span class="n">generate</span> <span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="n">k</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

            <span class="n">o</span> <span class="o">=</span> <span class="n">string_to_bits</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">24</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Kn</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Kn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]))</span>

        <span class="k">return</span>



    <span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plaintext</span><span class="p">):</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plaintext</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;plaintext must be a multiple of 16 in length&quot;</span><span class="p">)</span>

<span class="n">true</span> <span class="o">=</span> <span class="o">&amp;</span><span class="c1">#39;&amp;#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span><span class="p">):</span>

            <span class="n">block</span> <span class="o">=</span> <span class="n">plaintext</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">16</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span><span class="p">]</span>

            <span class="n">L</span> <span class="o">=</span> <span class="n">block</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>

            <span class="n">R</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>

            <span class="k">for</span> <span class="n">round_cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>

                <span class="n">L</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="p">(</span><span class="n">round_add</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kn</span><span class="p">[</span><span class="n">round_cnt</span><span class="p">]))</span>

            <span class="n">L</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">L</span>

            <span class="n">res</span> <span class="o">+=</span> <span class="n">L</span> <span class="o">+</span> <span class="n">R</span>

        <span class="k">return</span> <span class="n">res</span>
</code></pre></div>

<p>Obviously, we can think of it as a way of Feistel encryption, the decryption function is as follows</p>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ciphertext</span><span class="p">):</span>

<span class="n">true</span> <span class="o">=</span> <span class="o">&amp;</span><span class="c1">#39;&amp;#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span><span class="p">):</span>

            <span class="n">block</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">16</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span><span class="p">]</span>

            <span class="n">L</span> <span class="o">=</span> <span class="n">block</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>

            <span class="n">R</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>

            <span class="k">for</span> <span class="n">round_cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>

                <span class="n">L</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="p">(</span><span class="n">round_add</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Kn</span><span class="p">[</span><span class="mi">31</span><span class="o">-</span><span class="n">round_cnt</span><span class="p">]))</span>

            <span class="n">L</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span><span class="n">L</span>

            <span class="n">res</span> <span class="o">+=</span> <span class="n">L</span> <span class="o">+</span> <span class="n">R</span>

        <span class="k">return</span> <span class="n">res</span>
</code></pre></div>

<p>The final result is</p>
<div class="highlight"><pre><span></span><code>➜  baby_N1ES cat challenge.py

from N1ES import N1ES

import base64

<span class="nv">key</span> <span class="o">=</span> <span class="s2">&quot;wxy191iss00000000000cute&quot;</span>

<span class="nv">n1es</span> <span class="o">=</span> N1ES<span class="o">(</span>key<span class="o">)</span>

<span class="nv">flag</span> <span class="o">=</span> <span class="s2">&quot;N1CTF{*****************************************}&quot;</span>

<span class="nv">cipher</span> <span class="o">=</span> n1es.encrypt<span class="o">(</span>flag<span class="o">)</span>

<span class="c1">#print base64.b64encode(cipher)  # HRlgC2ReHW1/WRk2DikfNBo1dl1XZBJrRR9qECMNOjNHDktBJSxcI1hZIz07YjVx</span>

<span class="nv">cipher</span> <span class="o">=</span> <span class="s1">&#39;HRlgC2ReHW1/WRk2DikfNBo1dl1XZBJrRR9qECMNOjNHDktBJSxcI1hZIz07YjVx&#39;</span>

<span class="nv">cipher</span> <span class="o">=</span> base64.b64decode<span class="o">(</span>cipher<span class="o">)</span>

print n1es.decrypt<span class="o">(</span>cipher<span class="o">)</span>

➜  baby_N1ES python challenge.py

N1CTF <span class="o">{</span>F3istel_n3tw0rk_c4n_b3_ea5i1y_s0lv3d _ / - /<span class="o">}</span>
</code></pre></div>

<h2 id="2019-ciscn-part_des">2019 CISCN part_des<a class="headerlink" href="#2019-ciscn-part_des" title="Permanent link">&para;</a></h2>
<p>The title only gave one file:</p>
<div class="highlight"><pre><span></span><code>Round n part_encode-&gt; 0x92d915250119e12b

Key map -&gt; 0xe0be661032d5f0b676f82095e4d67623628fe6d376363183aed373a60167af537b46abc2af53d97485591f5bd94b944a3f49d94897ea1f699d1cdc291f2d9d4a5c705f2cad89e938dbacaca15e10d8aeaed90236f0be2e954a8cf0bea6112e84
</code></pre></div>

<p>Considering the title name and data characteristics, <code>Round n part_encode</code> is the intermediate result of executing n rounds of des, and <code>Key map</code> should be the subkey of des. To restore the plaintext, only the reverse process of n rounds of des encryption can be performed. Pay attention to the following three points when decrypting.</p>
<ul>
<li>Subkey selection, for only n rounds of encryption results, the decryption should use the keys n, n-1..., 1 in sequence.</li>
<li>des After the last round of operations, the unfinished des does not exchange the left and right parts and the inverse initial permutation, so we should perform these two steps on the ciphertext first.</li>
<li>n choice, in this question, we don&#39;t know n, but it doesn&#39;t matter, we can try all possible values (0-15) flag should be ascii string.</li>
</ul>
<p>??? note &quot;Solution code&quot;
    ``` python</p>
<p>kkk = 16
    def bit_rot_left(lst, pos):</p>
<div class="codehilite"><pre><span></span><code>    return lst[pos:] + lst[:pos]



class DES:

    IP = [

            58,50,42,34,26,18,10,2,60,52,44,36,28,20,12,4,

            62,54,46,38,30,22,14,6,64,56,48,40,32,24,16,8,

            57,49,41,33,25,17,9,1,59,51,43,35,27,19,11,3,

            61,53,45,37,29,21,13,5,63,55,47,39,31,23,15,7

        ]

    IP_re = [

            40,8,48,16,56,24,64,32,39,7,47,15,55,23,63,31,
            38,6,46,14,54,22,62,30,37,5,45,13,53,21,61,29,

            36,4,44,12,52,20,60,28,35,3,43,11,51,19,59,27,

            34,2,42,10,50,18,58,26,33,1,41,9,49,17,57,25

        ]

    Pbox = [

            16,7,20,21,29,12,28,17,1,15,23,26,5,18,31,10,

            2,8,24,14,32,27,3,9,19,13,30,6,22,11,4,25

        ]
</code></pre></div>


<p>E = [
                32,1,2,3,4,5,4,5,6,7,8,9,</p>
<div class="codehilite"><pre><span></span><code>            8,9,10,11,12,13,12,13,14,15,16,17,

            16,17,18,19,20,21,20,21,22,23,24,25,

            24,25,26,27,28,29,28,29,30,31,32,1

        ]

    PC1 = [

                57,49,41,33,25,17,9,1,58,50,42,34,26,18,

                10,2,59,51,43,35,27,19,11,3,60,52,44,36,

                63,55,47,39,31,23,15,7,62,54,46,38,30,22,

                14,6,61,53,45,37,29,21,13,5,28,20,12,4

        ]

    PC2 = [

            14,17,11,24,1,5,3,28,15,6,21,10,

            23,19,12,4,26,8,16,7,27,20,13,2,

            41,52,31,37,47,55,30,40,51,45,33,48,

            44,49,39,56,34,53,46,42,50,36,29,32

        ]
</code></pre></div>


<p>Sbox = [
                [</p>
<div class="codehilite"><pre><span></span><code>                [14,4,13,1,2,15,11,8,3,10,6,12,5,9,0,7],

                [0,15,7,4,14,2,13,1,10,6,12,11,9,5,3,8],

                [4,1,14,8,13,6,2,11,15,12,9,7,3,10,5,0],

                [15,12,8,2,4,9,1,7,5,11,3,14,10,0,6,13],

            ],

            [

                [15,1,8,14,6,11,3,4,9,7,2,13,12,0,5,10],

                [3,13,4,7,15,2,8,14,12,0,1,10,6,9,11,5],

                [0,14,7,11,10,4,13,1,5,8,12,6,9,3,2,15],

                [13,8,10,1,3,15,4,2,11,6,7,12,0,5,14,9],

            ],

            [

                [10,0,9,14,6,3,15,5,1,13,12,7,11,4,2,8],

                [13,7,0,9,3,4,6,10,2,8,5,14,12,11,15,1],

                [13,6,4,9,8,15,3,0,11,1,2,12,5,10,14,7],

                [1,10,13,0,6,9,8,7,4,15,14,3,11,5,2,12],

            ],

            [

                [7,13,14,3,0,6,9,10,1,2,8,5,11,12,4,15],

                [13,8,11,5,6,15,0,3,4,7,2,12,1,10,14,9],

                [10,6,9,0,12,11,7,13,15,1,3,14,5,2,8,4],

                [3,15,0,6,10,1,13,8,9,4,5,11,12,7,2,14],

            ],

            [

                [2,12,4,1,7,10,11,6,8,5,3,15,13,0,14,9],

                [14,11,2,12,4,7,13,1,5,0,15,10,3,9,8,6],

                [4,2,1,11,10,13,7,8,15,9,12,5,6,3,0,14],

                [11,8,12,7,1,14,2,13,6,15,0,9,10,4,5,3],

            ],

            [

                [12,1,10,15,9,2,6,8,0,13,3,4,14,7,5,11],

                [10,15,4,2,7,12,9,5,6,1,13,14,0,11,3,8],

                [9,14,15,5,2,8,12,3,7,0,4,10,1,13,11,6],

                [4,3,2,12,9,5,15,10,11,14,1,7,6,0,8,13],

            ],

            [

                [4,11,2,14,15,0,8,13,3,12,9,7,5,10,6,1],

                [13,0,11,7,4,9,1,10,14,3,5,12,2,15,8,6],

                [1,4,11,13,12,3,7,14,10,15,6,8,0,5,9,2],

                [6,11,13,8,1,4,10,7,9,5,0,15,14,2,3,12],

            ],

            [

                [13,2,8,4,6,15,11,1,10,9,3,14,5,0,12,7],

                [1,15,13,8,10,3,7,4,12,5,6,11,0,14,9,2],

                [7,11,4,1,9,12,14,2,0,6,10,13,15,3,5,8],

                [2,1,14,7,4,10,8,13,15,12,9,0,3,5,6,11],

            ]

        ]

    rout = [1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1]

    def __init__(self):

        self.subkey = [[[1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1], [1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1], [1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1], [1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1], [1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1], [1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0], [1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1], [0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0], [0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0], [0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1], [0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0], [0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0], [1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0], [1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0], [1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0], [1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0]], [[1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0], [1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0], [1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0], [1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0], [0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0], [0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1], [0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0], [0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0], [1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1], [1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0], [1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1], [1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1], [1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1], [1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1], [1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1]]]



    def permute(self, lst, tb):

        return [lst[i-1] for i in tb]



    def f(self,riti,subkeyi):

        tmp = [i^j for i,j in zip(subkeyi,self.permute(riti,DES.E))]

        return  self.permute(sum([[int(l) for l in str(bin(DES.Sbox[i][int(str(tmp[6*i])+str(tmp[6*i+5]),2)][int(&quot;&quot;.join(str(j) for j in tmp[6*i+1:6*i+5]),2)])[2:].zfill(4))] for i in range(8)],[]),DES.Pbox)



    def des_main(self,m,mark):

        sbkey = self.subkey[0]

        #if mark == &#39;e&#39; else self.subkey[1]

        # tmp =  self.permute([int(i) for i in list((m).ljust(64,&quot;0&quot;))],self.IP)

        tmp =  [int(i) for i in list((m).ljust(64,&quot;0&quot;))]
</code></pre></div>


<p>global kkk
print (kkk)
            for i in range(kkk):</p>
<div class="codehilite"><pre><span></span><code>            tmp = tmp[32:] + [j^k for j,k in zip(tmp[:32],self.f(tmp[32:],sbkey[i if mark != &#39;d&#39; else kkk-1-i]))]

        return &quot;&quot;.join([str(i) for i in self.permute(tmp[32:]+tmp[:32],self.IP_re)])



    def des_encipher(self,m):

        m = &quot;&quot;.join([bin(ord(i))[2:].zfill(8) for i in m])
</code></pre></div>


<p>des_en = self.des_main (m, &#39;e&#39;)
            return "".join([chr(int(des_en[i<em>8:i</em>8+8],2)) for i in range(8)])</p>
<div class="codehilite"><pre><span></span><code>    def des_decipher(self,c):

        c = &quot;&quot;.join([bin(ord(i))[2:].zfill(8) for i in c])
</code></pre></div>


<p>des_de = self.des_main (c, &#39;d&#39;)
            return "".join([chr(int(des_de[i<em>8:i</em>8+8],2)) for i in range(8)])</p>
<div class="codehilite"><pre><span></span><code>def test():

    import base64
</code></pre></div>


<p>global kkk
        while kkk &gt;=0:</p>
<p>desobj = DES ()
            # cipher = desobj.des_encipher("12345678")</p>
<div class="codehilite"><pre><span></span><code>        cipher = &#39;\x01\x19\xe1+\x92\xd9\x15%&#39;

        message1 = desobj.des_decipher(cipher)

        print(message1)
</code></pre></div>


<p>kkk = 1
    if <strong>name</strong>=='<strong>main</strong>':</p>
<div class="codehilite"><pre><span></span><code>    test()



```
</code></pre></div>


<p>Decryption result (partial):</p>
<div class="highlight"><pre><span></span><code>14
t-ÏEÏx§

13

y0ur9Ood
12

μp ^ Ûé = ¹
11

) Á`rûÕû
</code></pre></div>

<p>It can be seen that n is 13, and flag is <code>flag{y0ur9Ood}</code></p>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h2>
<p>Tsinghua University graduate data security courseware
- <a href="https://en.wikipedia.org/wiki/Data_Encryption_Standard">https://en.wikipedia.org/wiki/Data_Encryption_Standard</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../idea/" class="btn btn-neutral float-right" title="IDEA">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../arx-operations/" class="btn btn-neutral" title="ARX"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../arx-operations/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../idea/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js" defer></script>
      <script src="../../../_static/js/extra.js" defer></script>
      <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
